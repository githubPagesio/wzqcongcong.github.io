<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é—·éªšçš„æ‚Ÿç©º</title>
  
  <subtitle>ç«‹ä¸€ä¸šè°‹ç”Ÿ|æ‹©ä¸€åŸç»ˆè€|æºä¸€äººç™½é¦–</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zongquan.wang/"/>
  <updated>2017-11-02T12:04:29.000Z</updated>
  <id>https://zongquan.wang/</id>
  
  <author>
    <name>é—·éªšçš„æ‚Ÿç©º</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hack Cornerstone to load more logs</title>
    <link href="https://zongquan.wang/2017/11/02/Hack_Cornerstone_to_load_more_logs/"/>
    <id>https://zongquan.wang/2017/11/02/Hack_Cornerstone_to_load_more_logs/</id>
    <published>2017-11-02T09:51:44.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>Cornerstone æ¯æ¬¡åªèƒ½ load 50 æ¡ logsï¼Œæ‰€ä»¥æƒ³çœ‹ log çš„æ—¶å€™ï¼Œéœ€è¦é¢‘ç¹ç‚¹å‡» load æŒ‰é’®ï¼Œéå¸¸éº»çƒ¦ã€‚</p><p>ç”¨ Hopper Disassembler åˆ†æäº†ä¸€ä¸‹å®ƒçš„ä»£ç ï¼Œå‘ç°ä¸‹é¢å‡ å¤„è¢« hardcode æˆäº† 50ï¼š</p><ul><li><p><code>[V4LogTableViewController init]</code></p></li><li><p><code>[V4LogTableViewController controller]</code></p></li><li><p><code>[V4Log init]</code></p></li><li><p><code>[V4Log log]</code></p></li></ul><p>å°†è¿™äº›å‡½æ•°é‡Œé¢çš„ <code>mov edx, 0x32</code> æ”¹æˆ <code>mov edx, 0xff</code>ï¼Œè¿™æ ·æ¯æ¬¡å°±å¯ä»¥ load 255 æ¡ logs äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Cornerstone æ¯æ¬¡åªèƒ½ load 50 æ¡ logsï¼Œæ‰€ä»¥æƒ³çœ‹ log çš„æ—¶å€™ï¼Œéœ€è¦é¢‘ç¹ç‚¹å‡» load æŒ‰é’®ï¼Œéå¸¸éº»çƒ¦ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ Hopper Disassembler åˆ†æäº†ä¸€ä¸‹å®ƒçš„ä»£ç ï¼Œå‘ç°ä¸‹é¢å‡ å¤„è¢« hardcode æˆäº† 50ï¼š&lt;/p&gt;
&lt;ul&gt;
      
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>How to solve codesign issue &quot;signature too large to embed&quot;</title>
    <link href="https://zongquan.wang/2017/08/22/Signature_too_large_to_embed/"/>
    <id>https://zongquan.wang/2017/08/22/Signature_too_large_to_embed/</id>
    <published>2017-08-22T09:30:52.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨æ›´æ¢äº†è‹¹æœå¼€å‘è€…è¯ä¹¦åï¼Œç”¨ <em>codesign</em> ç­¾åæ—¶ä¼šæŠ¥é”™ï¼š<em>signature too large to embed</em>ã€‚å¤§æ„å°±æ˜¯ç­¾åæ•°æ®å¤ªå¤§ï¼Œè¶…å‡ºäº†é™åˆ¶ã€‚</p><p><strong>æ ¹æœ¬åŸå› </strong></p><p>é€šè¿‡æŸ¥çœ‹ <em>codesign</em> çš„<a href="https://opensource.apple.com/source/libsecurity_codesigning/libsecurity_codesigning-55037.15/lib/CodeSigner.cpp.auto.html" target="_blank" rel="noopener">æºä»£ç </a>å‘ç°ï¼Œå®ƒä¼šå¯¹ç­¾åæ•°æ®çš„å¤§å°è¿›è¡Œé™åˆ¶ï¼Œé»˜è®¤é™åˆ¶æ˜¯ 9000ã€‚</p><p><code>state.mCMSSize = 9000;</code></p><p>å¯ä»¥é€šè¿‡ <code>--signature-size</code> è¿™ä¸ª<a href="https://opensource.apple.com/source/security_systemkeychain/security_systemkeychain-55202/src/codesign.cpp.auto.html" target="_blank" rel="noopener">ç§æœ‰å‚æ•°</a>æ¥æ‰‹åŠ¨æ§åˆ¶è¯¥é™åˆ¶çš„å€¼ï¼Œè€Œä¸ä½¿ç”¨è¿™ä¸ªé»˜è®¤å€¼ã€‚è¯¥å‚æ•°å¹¶ä¸æ˜¯ <em>codesign</em> çš„å…¬å¼€å‚æ•°ã€‚</p><p><strong>å…·ä½“ç”¨æ³•</strong></p><p><code>codesign --signature-size 10000 -s &quot;XXX&quot;</code></p><p>ç½‘ä¸Šçœ‹åˆ°æœ‰äººè¯´åˆ©ç”¨ <code>--timestamp=none</code> å¯ä»¥è§£å†³è¯¥é—®é¢˜ï¼Œä½†å…¶å®æ˜¯æ²»æ ‡ä¸æ²»æœ¬ã€‚<code>--timestamp=none</code> æœ¬èº«ä¼šå‡å°‘ç­¾åæ•°æ®çš„å¤§å°ï¼Œæ‰€ä»¥æ‰çœ‹ä¼¼æœ‰æ•ˆæœã€‚</p><a id="more"></a><hr><p><strong>æŸ¥çœ‹æºä»£ç çš„å°çªé—¨</strong></p><ul><li>æŸ¥çœ‹ï¼š<a href="https://opensource.apple.com/source/libsecurity_codesigning/" target="_blank" rel="noopener">https://opensource.apple.com/source/libsecurity_codesigning/</a></li><li>ä¸‹è½½ï¼š<a href="https://opensource.apple.com/tarballs/libsecurity_codesigning/" target="_blank" rel="noopener">https://opensource.apple.com/tarballs/libsecurity_codesigning/</a></li></ul><p>åŒºåˆ«å°±æ˜¯é“¾æ¥é‡Œé¢çš„ <em>source</em> å’Œ <em>tarballs</em>ã€‚</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨æ›´æ¢äº†è‹¹æœå¼€å‘è€…è¯ä¹¦åï¼Œç”¨ &lt;em&gt;codesign&lt;/em&gt; ç­¾åæ—¶ä¼šæŠ¥é”™ï¼š&lt;em&gt;signature too large to embed&lt;/em&gt;ã€‚å¤§æ„å°±æ˜¯ç­¾åæ•°æ®å¤ªå¤§ï¼Œè¶…å‡ºäº†é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ ¹æœ¬åŸå› &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡æŸ¥çœ‹ &lt;em&gt;codesign&lt;/em&gt; çš„&lt;a href=&quot;https://opensource.apple.com/source/libsecurity_codesigning/libsecurity_codesigning-55037.15/lib/CodeSigner.cpp.auto.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æºä»£ç &lt;/a&gt;å‘ç°ï¼Œå®ƒä¼šå¯¹ç­¾åæ•°æ®çš„å¤§å°è¿›è¡Œé™åˆ¶ï¼Œé»˜è®¤é™åˆ¶æ˜¯ 9000ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;state.mCMSSize = 9000;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ &lt;code&gt;--signature-size&lt;/code&gt; è¿™ä¸ª&lt;a href=&quot;https://opensource.apple.com/source/security_systemkeychain/security_systemkeychain-55202/src/codesign.cpp.auto.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ç§æœ‰å‚æ•°&lt;/a&gt;æ¥æ‰‹åŠ¨æ§åˆ¶è¯¥é™åˆ¶çš„å€¼ï¼Œè€Œä¸ä½¿ç”¨è¿™ä¸ªé»˜è®¤å€¼ã€‚è¯¥å‚æ•°å¹¶ä¸æ˜¯ &lt;em&gt;codesign&lt;/em&gt; çš„å…¬å¼€å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…·ä½“ç”¨æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;codesign --signature-size 10000 -s &amp;quot;XXX&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç½‘ä¸Šçœ‹åˆ°æœ‰äººè¯´åˆ©ç”¨ &lt;code&gt;--timestamp=none&lt;/code&gt; å¯ä»¥è§£å†³è¯¥é—®é¢˜ï¼Œä½†å…¶å®æ˜¯æ²»æ ‡ä¸æ²»æœ¬ã€‚&lt;code&gt;--timestamp=none&lt;/code&gt; æœ¬èº«ä¼šå‡å°‘ç­¾åæ•°æ®çš„å¤§å°ï¼Œæ‰€ä»¥æ‰çœ‹ä¼¼æœ‰æ•ˆæœã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Xcode" scheme="https://zongquan.wang/tags/Xcode/"/>
    
  </entry>
  
  <entry>
    <title>Fix Bug for Interface Inspector on macOS Serria</title>
    <link href="https://zongquan.wang/2016/11/08/Fix_Bug_for_Interface_Inspector_on_macOS_Serria/"/>
    <id>https://zongquan.wang/2016/11/08/Fix_Bug_for_Interface_Inspector_on_macOS_Serria/</id>
    <published>2016-11-08T08:32:57.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ä»‹ç»è¿‡<a href="../../../../2016/04/21/Hack_Interface_Inspector/">å¦‚ä½•ç ´è§£ Interface Inspector</a>ï¼Œè¿‘æ¥æŠŠç³»ç»Ÿå‡çº§åˆ°æœ€æ–°çš„ macOS Serria ä¹‹åï¼Œå‘ç° Interface Inspector ä¸ work äº†ã€‚å¯åŠ¨å€’æ˜¯æ­£å¸¸ï¼Œä½†æ¯æ¬¡ attach app æ—¶ï¼Œæ€»æ˜¯æç¤ºæ— æ³• attachï¼ŒæŸ¥çœ‹ system logï¼Œå‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ª errorï¼š</p><p><img src="/img/Fix_Bug_for_Interface_Inspector_on_macOS_Serria/log.png" alt="log"></p><p>ä» log ä¸­çœ‹å‡ºï¼Œroot cause æ˜¯ <em>mach_inject_bundle_stub</em> å» load <code>___pthread_set_self</code> æ—¶å¤±è´¥äº†ï¼Œè€Œè¿™ä¸ªå‡½æ•°æœ¬æ¥åº”è¯¥æ˜¯åœ¨ <em>libSystem.B.dylb</em> è¿™ä¸ªç³»ç»Ÿåº“é‡Œé¢çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒmacOS Serria çš„ <em>libSystem.B.dylb</em> å·²ç»ä¸å†æœ‰ <code>___pthread_set_self</code> è¿™ä¸ªå‡½æ•°äº†ã€‚äºæ˜¯å¼€å§‹ googleï¼Œæœ€ååœ¨<a href="https://twitter.com/snielsen42/status/778405531383836674" target="_blank" rel="noopener">ä¸€æ¡ Twitter</a> ä¸Šå‘ç°äº†å’‹å›äº‹ï¼Œæ˜¯çš„ï¼Œ<code>___pthread_set_self</code> å·²ç»è¢«æ›¿æ¢æˆäº† <code>_pthread_set_self</code>ã€‚</p><p>æ˜ç™½äº†å’‹å›äº‹ï¼Œå¼€å§‹è€ƒè™‘æ€ä¹ˆè§£å†³ã€‚</p><a id="more"></a><h2 id="æ–¹æ³•-1ï¼š"><a href="#æ–¹æ³•-1ï¼š" class="headerlink" title="æ–¹æ³• 1ï¼š"></a>æ–¹æ³• 1ï¼š</h2><p>ä¿®æ”¹ <em>mach_inject_bundle_stub</em> çš„ load æŒ‡ä»¤ï¼Œä»æ—§ç‰ˆç³»ç»Ÿä¸­ copy ä¸€ä»½è€çš„ <em>libSystem.B.dylb</em>ï¼Œç„¶åè®© <em>mach_inject_bundle_stub</em> å» load è¿™ä¸ªè€çš„åº“ã€‚</p><h2 id="æ–¹æ³•-2ï¼š"><a href="#æ–¹æ³•-2ï¼š" class="headerlink" title="æ–¹æ³• 2ï¼š"></a>æ–¹æ³• 2ï¼š</h2><p>è¿˜æ˜¯ä¿®æ”¹ <em>mach_inject_bundle_stub</em>ï¼ŒæŠŠæ‰€æœ‰è°ƒç”¨ <code>___pthread_set_self</code> çš„åœ°æ–¹æ”¹æˆè°ƒç”¨ <code>_pthread_set_self</code>ã€‚</p><p>ç†è®ºä¸Šè¿™ä¸¤ç§æ–¹æ³•åº”è¯¥éƒ½å¯ä»¥çš„å§ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è‡ªå·±é€†å‘åŠŸåŠ›ä¸å¤Ÿï¼Œæ‰€ä»¥å°±é‡‡ç”¨äº†å¦‚ä¸‹çš„æ­£å‘æ–¹æ³• XDã€‚</p><h1 id="æ–¹æ³•-3ï¼š"><a href="#æ–¹æ³•-3ï¼š" class="headerlink" title="æ–¹æ³• 3ï¼š"></a>æ–¹æ³• 3ï¼š</h1><p>æˆ‘æœç´¢äº†ä¸€ä¸‹ <em>mach_inject_bundle_stub</em> è¿™ä¸ªä¸œè¥¿ï¼Œå‘ç°åŸæ¥æ˜¯ä¸ª GitHub ä¸Šçš„<a href="https://github.com/wzqcongcong/mach_inject" target="_blank" rel="noopener">å¼€æºåº“</a>ï¼ŒInterface Inspector å°±æ˜¯ç”¨çš„è¿™ä¸ªåº“ã€‚app ä¼šåœ¨ <code>/Library/Frameworks/mach_inject_bundle.framework</code> è¿™é‡Œå®‰è£…è¿™ä¸ªåº“ï¼Œè€Œ <em>mach_inject_bundle_stub</em> å°±æ˜¯è¿™ä¸ªåº“é‡Œé¢çš„ä¸€ä¸ªå­ bundleã€‚æœ‰äº† source code å°±å¥½åŠäº†ï¼Œåªéœ€è¦ä¿®æ”¹ codeï¼Œç„¶åé‡æ–°ç¼–è¯‘æ›¿æ¢æ‰ <em>mach_inject_bundle_stub</em> è¿™ä¸ª bundle å°±å¥½äº†ã€‚</p><p>æ­¥éª¤ï¼š</p><h3 id="1-fork-it"><a href="#1-fork-it" class="headerlink" title="1. fork it"></a>1. fork it</h3><h3 id="2-ä¿®æ”¹-code"><a href="#2-ä¿®æ”¹-code" class="headerlink" title="2. ä¿®æ”¹ code"></a>2. ä¿®æ”¹ code</h3><p><img src="/img/Fix_Bug_for_Interface_Inspector_on_macOS_Serria/github.png" alt="github"></p><h3 id="3-ç¼–è¯‘ç­¾å"><a href="#3-ç¼–è¯‘ç­¾å" class="headerlink" title="3. ç¼–è¯‘ç­¾å"></a>3. ç¼–è¯‘ç­¾å</h3><p>æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ï¼Œapp åœ¨ load <em>mach_inject_bundle_stub</em> è¿™ä¸ª bundle æ—¶ï¼Œæ˜¯æŒ‰ç…§ bundle id <code>com.rentzsch.mach-inject-bundle-stub</code> æ¥æ‰¾çš„ï¼Œæ‰€ä»¥éœ€è¦æŠŠå·¥ç¨‹æ–‡ä»¶é‡Œçš„ bundle id æ”¹æˆè·ŸåŸæ¥çš„ bundle id ä¸€æ ·ã€‚</p><h3 id="4-æ›¿æ¢åˆ°-mach-inject-bundle-framework-é‡Œé¢"><a href="#4-æ›¿æ¢åˆ°-mach-inject-bundle-framework-é‡Œé¢" class="headerlink" title="4. æ›¿æ¢åˆ° mach_inject_bundle.framework é‡Œé¢"></a>4. æ›¿æ¢åˆ° <em>mach_inject_bundle.framework</em> é‡Œé¢</h3><h3 id="5-é¡ºä¾¿æä¸€ä¸ª-pull-requestï¼Œè€ä»£ç å·²ç»å¹´ä¹…å¤±ä¿®äº†-XD"><a href="#5-é¡ºä¾¿æä¸€ä¸ª-pull-requestï¼Œè€ä»£ç å·²ç»å¹´ä¹…å¤±ä¿®äº†-XD" class="headerlink" title="5. é¡ºä¾¿æä¸€ä¸ª pull requestï¼Œè€ä»£ç å·²ç»å¹´ä¹…å¤±ä¿®äº† XD"></a>5. é¡ºä¾¿æä¸€ä¸ª pull requestï¼Œè€ä»£ç å·²ç»å¹´ä¹…å¤±ä¿®äº† XD</h3><p>å®Œæˆä¹‹åï¼Œé‡æ–°å¯åŠ¨ appï¼Œå¯ä»¥æ­£å¸¸ work äº†ï¼</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰ä»‹ç»è¿‡&lt;a href=&quot;../../../../2016/04/21/Hack_Interface_Inspector/&quot;&gt;å¦‚ä½•ç ´è§£ Interface Inspector&lt;/a&gt;ï¼Œè¿‘æ¥æŠŠç³»ç»Ÿå‡çº§åˆ°æœ€æ–°çš„ macOS Serria ä¹‹åï¼Œå‘ç° Interface Inspector ä¸ work äº†ã€‚å¯åŠ¨å€’æ˜¯æ­£å¸¸ï¼Œä½†æ¯æ¬¡ attach app æ—¶ï¼Œæ€»æ˜¯æç¤ºæ— æ³• attachï¼ŒæŸ¥çœ‹ system logï¼Œå‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ª errorï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/Fix_Bug_for_Interface_Inspector_on_macOS_Serria/log.png&quot; alt=&quot;log&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä» log ä¸­çœ‹å‡ºï¼Œroot cause æ˜¯ &lt;em&gt;mach_inject_bundle_stub&lt;/em&gt; å» load &lt;code&gt;___pthread_set_self&lt;/code&gt; æ—¶å¤±è´¥äº†ï¼Œè€Œè¿™ä¸ªå‡½æ•°æœ¬æ¥åº”è¯¥æ˜¯åœ¨ &lt;em&gt;libSystem.B.dylb&lt;/em&gt; è¿™ä¸ªç³»ç»Ÿåº“é‡Œé¢çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒmacOS Serria çš„ &lt;em&gt;libSystem.B.dylb&lt;/em&gt; å·²ç»ä¸å†æœ‰ &lt;code&gt;___pthread_set_self&lt;/code&gt; è¿™ä¸ªå‡½æ•°äº†ã€‚äºæ˜¯å¼€å§‹ googleï¼Œæœ€ååœ¨&lt;a href=&quot;https://twitter.com/snielsen42/status/778405531383836674&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¸€æ¡ Twitter&lt;/a&gt; ä¸Šå‘ç°äº†å’‹å›äº‹ï¼Œæ˜¯çš„ï¼Œ&lt;code&gt;___pthread_set_self&lt;/code&gt; å·²ç»è¢«æ›¿æ¢æˆäº† &lt;code&gt;_pthread_set_self&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ˜ç™½äº†å’‹å›äº‹ï¼Œå¼€å§‹è€ƒè™‘æ€ä¹ˆè§£å†³ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>Swift and Objective-C (Mix and Match)</title>
    <link href="https://zongquan.wang/2016/07/25/Swift_and_ObjectiveC_Mix_and_Match/"/>
    <id>https://zongquan.wang/2016/07/25/Swift_and_ObjectiveC_Mix_and_Match/</id>
    <published>2016-07-25T09:32:53.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>Swift ä¸ Objective-C æ··ç¼– ï¼ˆto be continuedï¼‰</p><h3 id="Code-ç›´æ¥æ··ç¼–-Framework-é—´æ¥æ··ç¼–"><a href="#Code-ç›´æ¥æ··ç¼–-Framework-é—´æ¥æ··ç¼–" class="headerlink" title="Code ç›´æ¥æ··ç¼– + Framework é—´æ¥æ··ç¼–"></a>Code ç›´æ¥æ··ç¼– + Framework é—´æ¥æ··ç¼–</h3><hr><h2 id="lt-Code-ç›´æ¥æ··ç¼–-gt"><a href="#lt-Code-ç›´æ¥æ··ç¼–-gt" class="headerlink" title="&lt; Code ç›´æ¥æ··ç¼– &gt;"></a>&lt; Code ç›´æ¥æ··ç¼– &gt;</h2><ul><li><h4 id="åœ¨-Objective-C-code-ä¸­ä½¿ç”¨-Swift-code"><a href="#åœ¨-Objective-C-code-ä¸­ä½¿ç”¨-Swift-code" class="headerlink" title="åœ¨ Objective-C code ä¸­ä½¿ç”¨ Swift code"></a>åœ¨ Objective-C code ä¸­ä½¿ç”¨ Swift code</h4><p>  Objective-C project: <code>Project_C</code><br>  PRODUCT_MODULE_NAME: <code>Project_C_Product</code></p><ol><li>in Project_Câ€™s build settings, set up <code>&quot;Embedded Content Contains Swift Code&quot;</code> to <code>&quot;YES&quot;</code>.</li><li>in Project_Câ€™s build settings, set up <code>&quot;Objective-C Generated Interface Header Name&quot;</code> to <code>&quot;Project_C_Product-Swift.h&quot;</code>.</li><li>Swift code should use <code>@objc</code> to mark what you want to expose to Objective-C code.</li><li>in Objective-C code, <code>#import &quot;Project_C_Product-Swift.h&quot;</code>.</li></ol></li></ul><a id="more"></a><ul><li><h4 id="åœ¨-Swift-code-ä¸­ä½¿ç”¨-Objective-C-code"><a href="#åœ¨-Swift-code-ä¸­ä½¿ç”¨-Objective-C-code" class="headerlink" title="åœ¨ Swift code ä¸­ä½¿ç”¨ Objective-C code"></a>åœ¨ Swift code ä¸­ä½¿ç”¨ Objective-C code</h4><p>  Swift project: <code>Project_S</code><br>  PRODUCT_MODULE_NAME: <code>Project_S_Product</code></p><ol><li>in Project_Sâ€™s build settings, set up <code>&quot;Objective-C Bridging Header&quot;</code> to <code>&quot;Project_S_Product-Bridging-Header.h&quot;</code>.</li><li>in <code>&quot;Project_S_Product-Bridging-Header.h&quot;</code>, <code>#import</code> every Objective-C header you want to expose to Swift code.</li><li>in Swift code, <em>NO</em> need to <code>#import &quot;Project_C_Product-Bridging-Header.h&quot;</code>.</li></ol></li></ul><h2 id="lt-Framework-é—´æ¥æ··ç¼–-gt"><a href="#lt-Framework-é—´æ¥æ··ç¼–-gt" class="headerlink" title="&lt; Framework é—´æ¥æ··ç¼– &gt;"></a>&lt; Framework é—´æ¥æ··ç¼– &gt;</h2><ul><li><h4 id="åˆ›å»º-Swift-framework-ç»™-Objective-C-code-ä½¿ç”¨"><a href="#åˆ›å»º-Swift-framework-ç»™-Objective-C-code-ä½¿ç”¨" class="headerlink" title="åˆ›å»º Swift framework ç»™ Objective-C code ä½¿ç”¨"></a>åˆ›å»º Swift framework ç»™ Objective-C code ä½¿ç”¨</h4><p>framework product: <code>Framework_S</code></p><p><strong>frameworkâ€™s side:</strong></p><ol><li>in Framework_Sâ€™s build settings, set up <code>&quot;Objective-C Generated Interface Header Name&quot;</code> to <code>&quot;Framework_S-Swift.h&quot;</code>.</li><li>use <code>@objc</code> to mark what you want to expose to Objective-C code.</li><li>after Framework_S is producted, its umbrella will include the <code>&quot;Framework_S-Swift.h&quot;</code> file.</li></ol><p><strong>consumerâ€™s side:</strong></p><ol><li>in build settings, set up <code>&quot;Embedded Content Contains Swift Code&quot;</code> to <code>&quot;YES&quot;</code>.</li><li><code>@import Framework_S</code>.</li></ol></li><li><h4 id="åˆ›å»º-Objective-C-framework-ç»™-Swift-code-ä½¿ç”¨"><a href="#åˆ›å»º-Objective-C-framework-ç»™-Swift-code-ä½¿ç”¨" class="headerlink" title="åˆ›å»º Objective-C framework ç»™ Swift code ä½¿ç”¨"></a>åˆ›å»º Objective-C framework ç»™ Swift code ä½¿ç”¨</h4><p>framework product: <code>Framework_C</code></p><p><strong>frameworkâ€™s side:</strong> nothing</p><p><strong>consumerâ€™s side:</strong> <code>import Framework_C</code></p></li></ul><hr><h4 id="Apple-å®˜æ–¹æ–‡æ¡£"><a href="#Apple-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="Apple å®˜æ–¹æ–‡æ¡£"></a><a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html" target="_blank" rel="noopener">Apple å®˜æ–¹æ–‡æ¡£</a></h4><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Swift ä¸ Objective-C æ··ç¼– ï¼ˆto be continuedï¼‰&lt;/p&gt;
&lt;h3 id=&quot;Code-ç›´æ¥æ··ç¼–-Framework-é—´æ¥æ··ç¼–&quot;&gt;&lt;a href=&quot;#Code-ç›´æ¥æ··ç¼–-Framework-é—´æ¥æ··ç¼–&quot; class=&quot;headerlink&quot; title=&quot;Code ç›´æ¥æ··ç¼– + Framework é—´æ¥æ··ç¼–&quot;&gt;&lt;/a&gt;Code ç›´æ¥æ··ç¼– + Framework é—´æ¥æ··ç¼–&lt;/h3&gt;&lt;hr&gt;
&lt;h2 id=&quot;lt-Code-ç›´æ¥æ··ç¼–-gt&quot;&gt;&lt;a href=&quot;#lt-Code-ç›´æ¥æ··ç¼–-gt&quot; class=&quot;headerlink&quot; title=&quot;&amp;lt; Code ç›´æ¥æ··ç¼– &amp;gt;&quot;&gt;&lt;/a&gt;&amp;lt; Code ç›´æ¥æ··ç¼– &amp;gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;h4 id=&quot;åœ¨-Objective-C-code-ä¸­ä½¿ç”¨-Swift-code&quot;&gt;&lt;a href=&quot;#åœ¨-Objective-C-code-ä¸­ä½¿ç”¨-Swift-code&quot; class=&quot;headerlink&quot; title=&quot;åœ¨ Objective-C code ä¸­ä½¿ç”¨ Swift code&quot;&gt;&lt;/a&gt;åœ¨ Objective-C code ä¸­ä½¿ç”¨ Swift code&lt;/h4&gt;&lt;p&gt;  Objective-C project: &lt;code&gt;Project_C&lt;/code&gt;&lt;br&gt;  PRODUCT_MODULE_NAME: &lt;code&gt;Project_C_Product&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;in Project_Câ€™s build settings, set up &lt;code&gt;&amp;quot;Embedded Content Contains Swift Code&amp;quot;&lt;/code&gt; to &lt;code&gt;&amp;quot;YES&amp;quot;&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;in Project_Câ€™s build settings, set up &lt;code&gt;&amp;quot;Objective-C Generated Interface Header Name&amp;quot;&lt;/code&gt; to &lt;code&gt;&amp;quot;Project_C_Product-Swift.h&amp;quot;&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Swift code should use &lt;code&gt;@objc&lt;/code&gt; to mark what you want to expose to Objective-C code.&lt;/li&gt;
&lt;li&gt;in Objective-C code, &lt;code&gt;#import &amp;quot;Project_C_Product-Swift.h&amp;quot;&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Swift" scheme="https://zongquan.wang/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Hack Interface Inspector</title>
    <link href="https://zongquan.wang/2016/04/21/Hack_Interface_Inspector/"/>
    <id>https://zongquan.wang/2016/04/21/Hack_Interface_Inspector/</id>
    <published>2016-04-21T12:38:11.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰åœ¨ iOSRE ä¸Šçœ‹åˆ°<a href="http://bbs.iosre.com/t/mac/3373" target="_blank" rel="noopener">ä¸€ç¯‡æ–‡ç« </a>ï¼Œé‡Œé¢æœ‰è®²åˆ°ä¸€ä¸ªé€†å‘ Mac app UI çš„å·¥å…· <a href="http://www.interface-inspector.com/" target="_blank" rel="noopener">Interface Inspector</a>ï¼Œæ‰«äº†ä¸€çœ¼ï¼Œå°¼ç›ç¥å™¨å•Šï¼Œç®€ç›´å°±æ˜¯ Reveal çš„ Mac ç‰ˆã€‚ä¸Šä¸ªå›¾æ„Ÿå—ä¸€ä¸‹å®ƒçš„æ·«å¨å§ï¼š</p><p><img src="/img/Hack_Interface_Inspector/ii.png" alt="Interface Inspector"></p><p>è¿™ä¹ˆå¥½çš„å·¥å…·ï¼Œè¿™ä¹ˆè´µçš„ä»·æ ¼ï¼Œå¿ƒç—’äº†ã€‚å¥½å§ï¼Œå‡­å€Ÿç€<a href="../../../../2016/01/12/Hack_XtraFinder/">ä¹‹å‰çš„ç ´è§£ç»éªŒ</a>ï¼Œå†æ¥æä¸€æ¬¡å§ã€‚</p><a id="more"></a><h3 id="0-å¼€å§‹"><a href="#0-å¼€å§‹" class="headerlink" title="0. å¼€å§‹"></a>0. å¼€å§‹</h3><p>é¦–å…ˆä»å®˜ç½‘ä¸‹è½½è¯•ç”¨ç‰ˆï¼Œæ‰“å¼€ appï¼Œç›´æ¥å¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ï¼š</p><p><img src="/img/Hack_Interface_Inspector/alert.png" alt="Alert"></p><p>å•Šå“ˆå“ˆï¼Œæœ€å–œæ¬¢è¿™ä¹ˆç›´æ¥çš„æ‰“æ‹›å‘¼äº†ã€‚</p><p>ç”¨ Hopper åŠ è½½å®Œ <em>Interface Inspector</em> åï¼Œå¯ä»¥ç›´æ¥å¥”ç€ä¸¤ä¸ªå‡½æ•°å»äº†ï¼š</p><p><img src="/img/Hack_Interface_Inspector/launching.png" alt="Launching"></p><h3 id="1-ç»•è¿‡ç­¾åæ ¡éªŒ"><a href="#1-ç»•è¿‡ç­¾åæ ¡éªŒ" class="headerlink" title="1. ç»•è¿‡ç­¾åæ ¡éªŒ"></a>1. ç»•è¿‡ç­¾åæ ¡éªŒ</h3><p>é¦–å…ˆçœ‹ä¸€ä¸‹ <code>[SMAppDelegate applicationWillFinishLaunching:]</code>ï¼Œé‡Œé¢æœ‰è¿™ä¹ˆä¸€æ®µï¼š</p><p><img src="/img/Hack_Interface_Inspector/will.png" alt="applicationWillFinishLaunching"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œapp å¯åŠ¨å®Œæˆä¹‹å‰ï¼Œä¼šè°ƒç”¨ <code>[[NSBundle mainBundle] codeSignState]</code> æ¥æ£€æŸ¥ bundle çš„ç­¾åæ˜¯å¦åˆæ³•ï¼ˆå…·ä½“å¦‚ä½•æ£€æŸ¥åé¢è¯¦è°ˆï¼‰ã€‚å¦‚æœä¸åˆæ³•ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†è¯´ â€œSignature of the Interface Inspector is brokenâ€ï¼Œç„¶å app å°±ç›´æ¥é€€å‡ºäº†ã€‚æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦ç»•è¿‡è¿™ä¸ªæ£€æŸ¥ã€‚</p><p>æ˜¾ç„¶ï¼Œ<code>codeSignState</code> è¿™ä¸ªå‡½æ•°å¹¶éå®˜æ–¹ apiï¼Œåº”è¯¥æ˜¯ä½œè€…è‡ªå·±æ·»åŠ çš„ <em>NSBundle category</em>ã€‚æœç´¢äº†ä¸€ä¸‹è¯¥å‡½æ•°åï¼Œæ²¡æœ‰æ‰¾åˆ°ã€‚äºæ˜¯å°±å» app çš„ <code>Frameworks</code> ç›®å½•ä¸‹çœ‹çœ‹æ˜¯ä¸æ˜¯ç”±ç¬¬ä¸‰æ–¹åº“å¼•å…¥çš„ã€‚åœ¨è¿™é‡Œæœ‰ 3 ä¸ª frameworkï¼š<em>DFeedback.framework</em>ã€<em>SMFoundation.framework</em>ã€<em>Sparkle.framework</em>ï¼Œå¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€ä¸ªè‚¯å®šæ˜¯æ”¶é›†ç”¨æˆ· feedback ç”¨çš„ï¼Œç¬¬ä¸‰ä¸ªå¤§å®¶éƒ½çŸ¥é“æ˜¯ update æ¨¡å—ï¼Œé‚£å°±å‰©ä¸‹ç¬¬äºŒä¸ªäº†ã€‚ç”¨ Hopper åŠ è½½ <em>SMFoundation</em>ï¼Œæœç„¶æœç´¢åˆ°äº† <code>codeSignState</code> è¿™ä¸ªå‡½æ•°ã€‚</p><p>åœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼Œä½œè€…æ˜¯ç”¨ <code>SecStaticCodeCheckValidityWithErrors</code> è¿™ä¸ªå®˜æ–¹ api æ¥æ£€æŸ¥ç­¾åçš„åˆæ³•æ€§çš„ã€‚å…·ä½“ç”¨æ³•å¯ä»¥æŸ¥é˜…æ–‡æ¡£ï¼Œè¿™é‡Œåªæä¸€ä¸‹æ¯”è¾ƒé‡è¦çš„ 2 ä¸ªå‚æ•°<code>staticCode</code> å’Œ <code>requirement</code>ï¼š<code>staticCode</code> æ˜¯å¾…æ ¡éªŒçš„ <em>code object</em>ï¼Œ<code>requirement</code> åˆ™è¡¨ç¤º <code>staticCode</code> éœ€è¦æ»¡è¶³çš„æ ¡éªŒæ¡ä»¶ã€‚ä½œè€…ä½¿ç”¨çš„æ ¡éªŒæ¡ä»¶æ˜¯ï¼š<code>certificate leaf = H&quot;0E1D40082148472951C6FB2DDCD8800D82629792&quot;</code>ã€‚çœ‹åˆ°è¿™é‡Œä¸€å¼€å§‹æˆ‘ä¹Ÿè’™äº†ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ã€‚åæ¥æŸ¥é˜…äº†ä¸€ä¸‹æ–‡æ¡£æ‰æ˜ç™½è¿™ä¸ªç”¨æ³•ã€‚å…¶å®å°±æ˜¯æ ¡éªŒä¸€ä¸‹ç­¾åè¯ä¹¦çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸æ˜¯ <code>H&quot;0E1D40082148472951C6FB2DDCD8800D82629792&quot;</code> è¿™ä¸ªå€¼ï¼Œè€Œè¿™ä¸€ä¸²å­—ç¬¦æ˜¯ç­¾åè¯ä¹¦çš„ <em>SHA1 FingerPrints</em>ï¼Œç”± 40 ä¸ª HEX å­—ç¬¦ç»„æˆï¼Œå¯ä»¥åœ¨è‡ªå·±çš„å¼€å‘è€…è¯ä¹¦é‡ŒæŸ¥åˆ°ï¼š</p><p><img src="/img/Hack_Interface_Inspector/cert.png" alt="Cert"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç”¨åˆ«äººçš„è¯ä¹¦é‡æ–°ç­¾åè¯¥ appï¼Œè€Œåˆæ²¡æœ‰åŒæ—¶ä¿®æ”¹è¿™ä¸ªæ ¡éªŒæ¡ä»¶çš„è¯ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„ç­¾åå°±æ˜¯ä¸åˆæ³•çš„ï¼Œapp å°±ä¼šé—ªé€€äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆæŠŠè¿™ä¸ªæ ¡éªŒæ¡ä»¶æ”¹æ‰ã€‚ç®€å•ï¼Œç›´æ¥æŠŠè¿™ä¸ªå­—ç¬¦ä¸²çš„å€¼æ”¹æˆè‡ªå·±å¼€å‘è€…è¯ä¹¦é‡Œé¢çš„ <em>SHA1 FingerPrints</em> å°±å¥½äº†ã€‚</p><p>OKï¼Œç­¾åæ ¡éªŒå·²ç»ç»•è¿‡å»äº†ï¼Œä¸‹é¢å°±å¯ä»¥éšæ„åœ°ä¿®æ”¹ app ç„¶åé‡æ–°ç­¾åäº†ã€‚</p><h3 id="2-ç ´è§£-License-æœºåˆ¶"><a href="#2-ç ´è§£-License-æœºåˆ¶" class="headerlink" title="2. ç ´è§£ License æœºåˆ¶"></a>2. ç ´è§£ License æœºåˆ¶</h3><p><code>[SMAppDelegate applicationWillFinishLaunching:]</code> å·²ç»æ²¡ä»€ä¹ˆå¥½çœ‹çš„äº†ï¼Œæ¥ç€çœ‹ <code>[SMAppDelegate applicationDidFinishLaunching:]</code>ï¼Œé‡Œé¢æœ‰è¿™ä¹ˆä¸€æ®µï¼š</p><p><img src="/img/Hack_Interface_Inspector/did.png" alt="applicationDidFinishLaunching"></p><p>å¤ªæ˜æ˜¾äº†ï¼Œæ²¡æœ‰ license çš„è¯å°±æç¤ºç”¨æˆ·è¾“å…¥åºåˆ—å·è¿›è¡Œæ¿€æ´»ã€‚é¡ºè—¤æ‘¸ç“œï¼Œæœ€ç»ˆæ‰¾åˆ°äº†è¿™ä¹ˆä¸ªå‡½æ•° <code>[SMLicenseManager verifyLicenseWithName:code:]</code>ï¼Œå®ƒå°±æ˜¯ç”¨æ¥éªŒè¯ license æ˜¯å¦åˆæ³•çš„ï¼åªè¦æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œç ´è§£ï¼Œè¿™æ ·éšä¾¿è¾“å…¥ä»»æ„åºåˆ—å·å°±å¯ä»¥æ¿€æ´»äº†ï¼Œå•Šå“ˆå“ˆã€‚</p><p>ç®€å•å¾—ä¸èƒ½å†ç®€å•äº†ï¼Œç›´æ¥ç”¨ Hopper çš„ <em>Modify</em> åŠŸèƒ½ä¿®æ”¹æˆ <code>mov eax, 0x1</code> <code>ret</code> å³å¯ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è¿”å› <code>YES</code> é€šè¿‡éªŒè¯ã€‚</p><p>ä¿®æ”¹å®Œæˆï¼Œé‡æ–°ç­¾åï¼Œè¿è¡Œ appï¼Œå•Šå“¦ï¼Œé—ªé€€äº†ï¼</p><h3 id="3-ä½œè€…çš„é¬¼ç‚¹å­"><a href="#3-ä½œè€…çš„é¬¼ç‚¹å­" class="headerlink" title="3. ä½œè€…çš„é¬¼ç‚¹å­"></a>3. ä½œè€…çš„é¬¼ç‚¹å­</h3><p>çœ‹æ¥è¿˜æ˜¯æœ‰ä»€ä¹ˆåœ°æ–¹æ²¡æ”¹å¥½ã€‚é‡æ–°å›å»æ£€æŸ¥æ•´ä¸ª <code>SMLicenseManager</code> ç±»ï¼Œä¸€ä¸ªå‡½æ•°ä¸€ä¸ªå‡½æ•°åœ°æ£€æŸ¥ï¼Œæœ€ç»ˆå‘ç°äº†è¿™ä¹ˆä¸ªå‡½æ•° <code>[SMLicenseManager load]</code>ã€‚ä½œè€…åœ¨è¿™é‡Œè€äº†ä¸€ä¸ªå°èŠ±æ‹›ï¼š</p><p><img src="/img/Hack_Interface_Inspector/tricky.png" alt="Tricky"></p><p>æ˜¯çš„ï¼Œæˆ‘ä»¬æŠŠ <code>[SMLicenseManager verifyLicenseWithName:code:]</code> æ”¹æˆäº†æ€»æ˜¯è¿”å› <code>YES</code>ï¼Œä½†æ˜¯ä»£ç èµ°åˆ°è¿™é‡Œæ’å¢™äº†ï¼Œ<em>Test User</em> éªŒè¯ä¹‹åä¹Ÿè¿”å› <code>YES</code> äº†ï¼Œç„¶å app ç›´æ¥ <code>terminate:</code> äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½œè€…åœ¨è¿™é‡Œæ”¾äº†ä¸€ä¸ªæœ¬æ¥å°±æ˜¯éæ³•çš„ licenseï¼Œæ­£å¸¸éªŒè¯çš„è¯è‚¯å®šæ˜¯è¿”å› <code>NO</code> çš„ï¼Œå°±ä¸ä¼šå¯¼è‡´ç›´æ¥é€€å‡ºäº†ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æŠŠè¿™é‡Œçš„åˆ¤æ–­æ¡ä»¶æ”¹æˆ <code>XXX == NO</code>ï¼Œè¿™æ ·å°±æ²¡æœ‰é—®é¢˜äº†ã€‚çœŸæ˜¯æ·˜æ°”çš„ä½œè€…ï¼Œè—å¾—è¿™ä¹ˆæ·±ã€‚</p><p>å¥½äº†ï¼Œæ”¹å¥½ï¼Œé‡æ–°ç­¾åï¼Œè¿è¡Œ appï¼Œéšä¾¿è¾“å…¥ license ä¿¡æ¯ï¼Œå•Šå“ˆå“ˆï¼Œæ³¨å†ŒæˆåŠŸï¼</p><p><img src="/img/Hack_Interface_Inspector/done.png" alt="Done"></p><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰åœ¨ iOSRE ä¸Šçœ‹åˆ°&lt;a href=&quot;http://bbs.iosre.com/t/mac/3373&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¸€ç¯‡æ–‡ç« &lt;/a&gt;ï¼Œé‡Œé¢æœ‰è®²åˆ°ä¸€ä¸ªé€†å‘ Mac app UI çš„å·¥å…· &lt;a href=&quot;http://www.interface-inspector.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Interface Inspector&lt;/a&gt;ï¼Œæ‰«äº†ä¸€çœ¼ï¼Œå°¼ç›ç¥å™¨å•Šï¼Œç®€ç›´å°±æ˜¯ Reveal çš„ Mac ç‰ˆã€‚ä¸Šä¸ªå›¾æ„Ÿå—ä¸€ä¸‹å®ƒçš„æ·«å¨å§ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/Hack_Interface_Inspector/ii.png&quot; alt=&quot;Interface Inspector&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¹ˆå¥½çš„å·¥å…·ï¼Œè¿™ä¹ˆè´µçš„ä»·æ ¼ï¼Œå¿ƒç—’äº†ã€‚å¥½å§ï¼Œå‡­å€Ÿç€&lt;a href=&quot;../../../../2016/01/12/Hack_XtraFinder/&quot;&gt;ä¹‹å‰çš„ç ´è§£ç»éªŒ&lt;/a&gt;ï¼Œå†æ¥æä¸€æ¬¡å§ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>How to install iOSOpenDev manually</title>
    <link href="https://zongquan.wang/2016/03/29/How_to_install_iOSOpenDev_manually/"/>
    <id>https://zongquan.wang/2016/03/29/How_to_install_iOSOpenDev_manually/</id>
    <published>2016-03-29T15:30:35.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/wzqcongcong/iOSOpenDev" target="_blank" rel="noopener">https://github.com/wzqcongcong/iOSOpenDev</a></p><a id="more"></a><hr><h3 id="OS-X-10-10-amp-Xcode-7"><a href="#OS-X-10-10-amp-Xcode-7" class="headerlink" title="OS X 10.10+ &amp; Xcode 7+"></a>OS X 10.10+ &amp; Xcode 7+</h3><ol><li><p><strong>Dependency</strong></p><p><code>brew install ldid dpkg</code></p></li><li><p><strong>Theos</strong></p><p><a href="https://github.com/theos/theos/wiki" target="_blank" rel="noopener">Wiki</a></p><p><a href="http://iphonedevwiki.net/index.php/Theos/Setup" target="_blank" rel="noopener">Setup</a></p></li><li><p><strong>iOSOpenDev</strong></p><p><a href="https://github.com/kokoabim/iOSOpenDev/wiki" target="_blank" rel="noopener">Wiki</a></p><p>3.1. update <strong>.zshrc</strong></p><p><code>export iOSOpenDevPath=path/to/iOSOpenDev</code></p><p><code>export iOSOpenDevDevice=</code></p><p><code>export PATH=$iOSOpenDevPath:$PATH</code></p><p>3.2. get <strong>iOSOpenDev</strong></p><ul><li><p><code>git clone --recursive https://github.com/kokoabim/iOSOpenDev.git $iOSOpenDevPath</code></p></li><li><p>copy the folder <a href="https://github.com/wzqcongcong/iOSOpenDev" target="_blank" rel="noopener"><strong>templates</strong></a> into <em>$iOSOpenDevPath</em></p></li></ul><p>this version of <strong>templates</strong> is refined by the <a href="https://github.com/kokoabim/iOSOpenDev-Xcode-Templates" target="_blank" rel="noopener">original one</a>: the <em>ShellScript</em> of <em>BuildPhases</em> in <strong>TemplateInfo.plist</strong> is changed to <code>$iOSOpenDevPath/bin/iosod --xcbp</code>. and the <em>[$iOSOpenDevPath]</em> here is not that in <em>.zshrc</em>, it is a user defined key in <strong>Base.xctemplate</strong> and <strong>Empty Project.xctemplate</strong>.</p><p>3.3. setup <strong>Xcode</strong></p><ul><li><p>copy the <a href="https://github.com/wzqcongcong/iOSOpenDev" target="_blank" rel="noopener"><strong>.xcspec</strong></a> files into <em>/Applications/Xcode/Content/Developer/Platforms/[PLATFORM_PATH]/Developer/Library/Xcode/Specifications</em> (mkdir if not existed)</p></li><li><p><code>mkdir -p /Applications/Xcode/Content/Developer/Platforms/[PLATFORM_PATH]/Developer/usr/bin</code></p></li><li><p><code>ln -fhs $iOSOpenDevPath/bin/iosod /Applications/Xcode/Content/Developer/Platforms/[PLATFORM_PATH]/Developer/usr/bin</code></p></li><li><p><code>ln -fhs $iOSOpenDevPath/bin/ldid /Applications/Xcode/Content/Developer/Platforms/[PLATFORM_PATH]/Developer/usr/bin</code></p></li></ul><p>3.4. setup <strong>SDK</strong></p><ul><li><p>modify the following key/value in <strong>[SDK_PATH]/SDKSettings.plist</strong>:</p><pre><code>DefaultProperties.CODE_SIGNING_REQUIRED =&gt; NODefaultProperties.ENTITLEMENTS_REQUIRED =&gt; NODefaultProperties.AD_HOC_CODE_SIGNING_ALLOWED =&gt; YES</code></pre></li><li><p>in Xcode 7.3, the private framework has been removed from iOS 9.3 SDK, so maybe you want to use iOS 9.2 SDK. once you copy iOS 9.2 SDK into <em>[PLATFORM_PATH]/Developer/SDKs</em>, you should also modify <strong>[PLATFORM_PATH]/Info.plist</strong> as following, or else Xcode 7.3 can not recognize iOS 9.2 SDK in project build settings:</p><pre><code>MinimumSDKVersion =&gt; 9.2</code></pre></li></ul><p>3.5. setup <strong>templates</strong></p><ul><li><code>ln -fhs $iOSOpenDevPath/templates ~/Library/Developer/Xcode/Templates/iOSOpenDev</code></li><li>open <strong>TemplateInfo.plist</strong> in <strong>Base.xctemplate</strong> and <strong>Empty Project.xctemplate</strong> with Xcode, then set the value of the user defined key <em>[iOSOpenDevPath]</em> to <em>path/to/iOSOpenDev</em>.</li></ul></li></ol><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/wzqcongcong/iOSOpenDev&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/wzqcongcong/iOSOpenDev&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Xcode" scheme="https://zongquan.wang/tags/Xcode/"/>
    
  </entry>
  
  <entry>
    <title>Hack XtraFinder</title>
    <link href="https://zongquan.wang/2016/01/12/Hack_XtraFinder/"/>
    <id>https://zongquan.wang/2016/01/12/Hack_XtraFinder/</id>
    <published>2016-01-12T15:38:55.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œæˆ‘çš„ç³»ç»Ÿæ˜¯ OS X 10.11ï¼Œå°±æ˜¯é‚£ä¸ªæœ‰ SIP çš„ 10.11 ğŸ˜‚ã€‚ç„¶åæˆ‘è£…äº†ä¸€ä¸ª Finder çš„æ’ä»¶ï¼šXtraFinderï¼Œè¿™ä¸ªæ’ä»¶æœ‰äº›åŠŸèƒ½åœ¨ 10.11 ä¸‹æ˜¯ä¸ work çš„ï¼Œæ‰€ä»¥æ’ä»¶ä½œè€…å‡ºäºå¥½å¿ƒï¼Œåœ¨æ£€æµ‹åˆ°ä½ çš„ç³»ç»Ÿæ˜¯ 10.11 ä¸” SIP æ²¡æœ‰å…³é—­çš„æƒ…å†µä¸‹ï¼Œä¼šå¼¹å‡ºä¸€ä¸ª alert çª—å£ä½œä¸ºæé†’ã€‚</p><a id="more"></a><p><img src="/img/Hack_XtraFinder/alert.png" alt="Alert"></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä½œè€…æ£€æµ‹ SIP æ˜¯å¦å…³é—­çš„æ–¹æ³•æœ‰ä¸ª bugï¼Œå¯¼è‡´æˆ‘æ˜æ˜æ˜¯å®Œå…¨å…³é—­äº† SIPï¼Œä½†æ’ä»¶å´è®¤ä¸º SIP è¿˜åœ¨å¯ç”¨ã€‚ç¬¬äºŒä¸ªé—®é¢˜ï¼Œè¿™ä¸ª alert æ¯æ¬¡é‡å¯æ’ä»¶ï¼ˆåŒ…æ‹¬æ¯æ¬¡é‡å¯ç³»ç»Ÿï¼‰æ—¶éƒ½ä¼šå¼¹å‡ºæ¥å•Šï¼Œå‡ºæ¥å•Šï¼Œæ¥å•Šï¼Œå•Šï¼Œæå¾—ä½ æ¯æ¬¡éƒ½è¦å»ç‚¹ä¸€ä¸‹ç¡®è®¤æ‰èƒ½å°†å…¶å…³é—­ï¼Œçƒ¦çš„å¾ˆ ğŸ˜’ã€‚æˆ‘æ›¾ç»ç»™ä½œè€…å‘é‚®ä»¶ï¼Œå¸Œæœ›ä»–èƒ½ update ä¸€ä¸‹ï¼Œåªå¼¹ä¸€æ¬¡ alert å°±å¥½ã€‚å½“ç„¶äº†ï¼Œä½œè€…æ²¡æœ‰é¸Ÿæˆ‘ã€‚</p><p>ä½œä¸ºå¶å°”ä¼šç”¨ Hopper Disassembler å·çª¥ä¸€ä¸‹åˆ«äººä»£ç çš„æˆ‘ï¼Œå°±å¼€å§‹æ„æ·«èƒ½ä¸èƒ½ hack ä¸€ä¸‹è¿™ä¸ªæ’ä»¶ï¼Œæ”¹æ‰è¿™ä¸ªæ¶å¿ƒçš„è¡Œä¸ºã€‚</p><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><ul><li>Hopper Disassembler</li><li>Hex Fiend</li><li>Developer ID Application è¯ä¹¦</li></ul><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li><p>ç”¨ Hopper Disassembler å®šä½ hack point</p><p> è¿™ä¸ª alert æ˜¯æ’ä»¶ä¸€å¯åŠ¨çš„æ—¶å€™å°±å¼¹å‡ºçš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°å…ˆå» check ä¸€ä¸‹ <code>[AppDelegate applicationDidFinishLaunching:]</code> è¿™ä¸ªæ–¹æ³•ã€‚Load Mach-O æ–‡ä»¶åï¼Œç›´å¥”é‚£ä¸ªå‡½æ•°çš„ä¼ªä»£ç ï¼š</p><p> <img src="/img/Hack_XtraFinder/hopper1.png" alt="Hopper Disassembler"></p><p> ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ’ä»¶ä½œè€…é€šè¿‡ <code>csrutil status</code> çš„è¿”å›ç»“æœæ¥åˆ¤æ–­ SIP çš„çŠ¶æ€ï¼Œåªæœ‰è¿”å›ç»“æœä¸­åŒ¹é…åˆ°äº†å­—ç¬¦ä¸² <code>&quot;Debugging Restrictions: disabled&quot;</code> æ‰è®¤ä¸º SIP å…³é—­ã€‚ä½†æ˜¯ï¼Œæˆ‘æ˜¯å®Œå…¨å…³é—­ SIP çš„ï¼Œè¿è¡Œ <code>csrutil status</code> çš„ç»“æœæ˜¯ <code>System Integrity Protection status: disabled.</code>ï¼Œæ˜¾ç„¶æ— æ³•åŒ¹é…é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å°±è¢«è¯¯è®¤ä¸ºæ˜¯ SIP å°šæœªå…³é—­ã€‚</p><p> æ³¨æ„ï¼Œä¸Šå›¾ä¸­è“è‰²æ¡†ä¸­çš„å†…å®¹æ˜¯æˆ‘ä¿®æ”¹ä¹‹åçš„ï¼ŒåŸå†…å®¹æ˜¯ <code>if (rax != rcx) goto loc_100001df7;</code>ï¼Œä¹Ÿå°±æ˜¯å½“ <code>[rax rangeOfString:rdx] != NSNotFound</code> çš„æ—¶å€™ï¼Œå­—ç¬¦ä¸²åŒ¹é…æˆåŠŸï¼Œå°±è·³è¿‡ä¸å¼¹ alertã€‚çœ‹åˆ°è¿™é‡Œä½ å·²ç»çŸ¥é“äº†ï¼Œåªè¦æŠŠæ¡ä»¶åè½¬å°±å¤§åŠŸå‘Šæˆäº†ã€‚</p><p> å½“ç„¶ï¼Œé™¤äº†åè½¬åˆ¤æ–­æ¡ä»¶ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä¿®æ”¹é‚£ä¸ªç”¨äºåŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ä¿®æ”¹æˆ <code>&quot;disabled&quot;</code> å°±å¥½äº†ï¼Œéƒ½èƒ½å¤ŸåŒ¹é…æˆåŠŸã€‚</p><p> å¥½äº†ï¼Œä¼ªä»£ç æ˜¯çœ‹æ˜ç™½äº†ï¼Œä¸‹é¢å°±å¾—çœ‹å¦‚ä½•è®©è¿™ä¸ªåˆ¤æ–­æ¡ä»¶åè½¬äº†ã€‚</p><p> <img src="/img/Hack_XtraFinder/hopper2.png" alt="Hopper Disassembler"></p><p> ä¸Šå›¾ä¸­çº¢è‰²æ¡†ä¸­çš„æ±‡ç¼–ä»£ç å¯¹åº”å‰é¢åˆ†æçš„é‚£å—ä¼ªä»£ç ï¼Œè€Œè“è‰²æ¡†ä¸­çš„åå…­è¿›åˆ¶ <code>0F 84 E1 01 00 00</code> ä»£è¡¨ä¼ªä»£ç å—ä¸­çš„æœ€åé‚£æ¡å‘½ä»¤ <code>0x0000000100001c10         je         0x100001df7</code>ã€‚<code>je</code> è¿™ä¸ªæŒ‡ä»¤è¡¨ç¤º <em><code>å¦‚æœç­‰äºåˆ™è·³è½¬åˆ°</code></em>ï¼Œå®ƒçš„åæŒ‡ä»¤æ˜¯ <code>jne</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠæœ€åè¿™æ¡å‘½ä»¤æ”¹ä¸º <code>jne         0x100001df7</code>ã€‚å‚è€ƒä¸€ä¸‹<a href="http://neuzxy.blog.51cto.com/10270223/1716326" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ï¼Œå…¶å®å°±æ˜¯æŠŠ <code>0F 84 E1 01 00 00</code> æ”¹ä¸º <code>0F 85 E1 01 00 00</code>ï¼ŒæŠŠ 4 æ”¹æˆ 5ã€‚</p></li><li><p>ç”¨ Hex Fiend ä¿®æ”¹ Mach-O æ–‡ä»¶</p><p> æ˜ç™½äº†æ”¹ä»€ä¹ˆï¼Œä¸‹é¢å°±æ˜¯å¼€å§‹æ“ä½œäº†ã€‚ç”¨ Hex Fiend æ‰“å¼€ Mach-O æ–‡ä»¶ï¼Œç›´æ¥æŸ¥æ‰¾æ›¿æ¢å³å¯ã€‚</p><p> <img src="/img/Hack_XtraFinder/hex1.png" alt="Hex Fiend"></p><p> åªæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šå¦‚æœç›´æ¥æŸ¥æ‰¾ <code>0F 84 E1 01 00 00</code> çš„è¯ï¼Œå¯èƒ½æœ‰å¤šå¤„ï¼Œæ‰€ä»¥ä¸ºäº†å‡†ç¡®å®šä½ï¼Œæˆ‘ä»¬å¯ä»¥è¿åŒä¸‹ä¸€æ¡å‘½ä»¤ä¸€èµ·æ¥æŸ¥æ‰¾ï¼Œå¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬æŸ¥æ‰¾ <code>0F 84 E1 01 00 00 48 8B 3D 6B 14 01 00</code>ï¼Œè¿™æ ·å°±ä¼šåªæ‰¾åˆ°å”¯ä¸€çš„ä¸€å¤„ã€‚</p><p> æ›¿æ¢å®Œæˆåä¿å­˜å³å¯ã€‚</p></li><li><p>é‡æ–°ç­¾å</p><p> ä¿®æ”¹åçš„ Mach-O æ–‡ä»¶æ˜¯æ— æ³•è¿è¡Œçš„ï¼Œå› ä¸ºç­¾åä¸å¯¹äº†ã€‚æ‰€ä»¥éœ€è¦æˆ‘ä»¬ç”¨è‡ªå·±çš„å¼€å‘è€…è¯ä¹¦é‡ç­¾ä¸€ä¸‹ï¼š<code>codesign -f -s &quot;XXX è¯ä¹¦çš„ Common Name&quot; /Applications/XtraFinder.app/Contents/MacOS/XtraFinder</code>ã€‚</p><p> å¤§åŠŸå‘Šæˆï¼Œè¦†ç›–é‡å¯æ’ä»¶åï¼Œå†ä¹Ÿæ²¡æœ‰å¼¹å‡º alertï¼ŒXtraFinder ç…§å¸¸ work ğŸ˜†ã€‚</p></li></ol><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œæˆ‘çš„ç³»ç»Ÿæ˜¯ OS X 10.11ï¼Œå°±æ˜¯é‚£ä¸ªæœ‰ SIP çš„ 10.11 ğŸ˜‚ã€‚ç„¶åæˆ‘è£…äº†ä¸€ä¸ª Finder çš„æ’ä»¶ï¼šXtraFinderï¼Œè¿™ä¸ªæ’ä»¶æœ‰äº›åŠŸèƒ½åœ¨ 10.11 ä¸‹æ˜¯ä¸ work çš„ï¼Œæ‰€ä»¥æ’ä»¶ä½œè€…å‡ºäºå¥½å¿ƒï¼Œåœ¨æ£€æµ‹åˆ°ä½ çš„ç³»ç»Ÿæ˜¯ 10.11 ä¸” SIP æ²¡æœ‰å…³é—­çš„æƒ…å†µä¸‹ï¼Œä¼šå¼¹å‡ºä¸€ä¸ª alert çª—å£ä½œä¸ºæé†’ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>Xcode Build Settings - Products Path</title>
    <link href="https://zongquan.wang/2015/11/16/Xcode_Build_Settings_Products_Path/"/>
    <id>https://zongquan.wang/2015/11/16/Xcode_Build_Settings_Products_Path/</id>
    <published>2015-11-16T12:21:54.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‡è®¾ä¸€ä¸ª Project çš„è·¯å¾„æ˜¯ <code>XXX/ProjectX</code>ã€‚</p><p>å½“ build å®Œæˆåï¼Œæˆ‘ä»¬ä¼šå…³æ³¨ 2 ä¸ªä¸ <strong>Product Files</strong> æœ‰å…³çš„ settings ï¼š</p><a id="more"></a><p><strong><code>$BUILT_PRODUCTS_DIR</code></strong> å’Œ <strong><code>$TARGET_BUILD_DIR</code></strong></p><p>è¿™ 2 ä¸ª settings å†³å®šäº†æˆ‘ä»¬ build å‡ºæ¥çš„ Products è¢«æ”¾ç½®åˆ°äº†å“ªé‡Œã€‚</p><h4 id="å®˜æ–¹è§£é‡Š"><a href="#å®˜æ–¹è§£é‡Š" class="headerlink" title="å®˜æ–¹è§£é‡Š"></a>å®˜æ–¹è§£é‡Š</h4><ul><li><p><strong><code>$BUILT_PRODUCTS_DIR</code></strong>ï¼šDirectory path. Identifies the directory under which all the productâ€™s files can be found. This directory contains either product files or symbolic links to them.</p></li><li><p><strong><code>$TARGET_BUILD_DIR</code></strong>ï¼šDirectory path. Identifies the root of the directory hierarchy that contains the productâ€™s files (no intermediate build files).</p></li></ul><p>ä¹ä¸€çœ‹å¥½åƒéƒ½æ˜¯ç”¨æ¥å­˜æ”¾ <strong>Product Files</strong> çš„ç›®å½•ï¼Œä½†æ˜¯å®ƒä»¬çš„ä½œç”¨æ˜¯ä¸ä¸€æ ·çš„ï¼š</p><p>åˆšç¼–è¯‘å®Œçš„æ—¶å€™ï¼ŒXcode ä¼šå…ˆæŠŠ <strong>Product Files</strong> ç”Ÿæˆåˆ° <strong><code>$BUILT_PRODUCTS_DIR</code></strong> ä¸­ï¼Œç„¶åå†æ ¹æ®å…·ä½“çš„ configuration æ¥å†³å®šè¦ä¸è¦å¯¹ç”Ÿæˆçš„ <strong>Product Files</strong> è¿›è¡Œ deployï¼Œå¦‚æœä¸éœ€è¦ deployï¼Œé‚£ä¹ˆ <strong>Product Files</strong> æœ€åè¿˜æ˜¯ç•™åœ¨ <strong><code>$BUILT_PRODUCTS_DIR</code></strong> ä¸­ï¼Œå¦‚æœéœ€è¦ deployï¼Œé‚£ä¹ˆ <strong>Product Files</strong> ä¼šè¢« move åˆ° <strong><code>$TARGET_BUILD_DIR</code></strong> ä¸­ï¼Œè€ŒåŸæ¥çš„ <strong><code>$BUILT_PRODUCTS_DIR</code></strong> ä¸­å°±åªæœ‰ symbolic links äº†ã€‚</p><h4 id="ä¸¾ä¸ªä¾‹å­"><a href="#ä¸¾ä¸ªä¾‹å­" class="headerlink" title="ä¸¾ä¸ªä¾‹å­"></a>ä¸¾ä¸ªä¾‹å­</h4><p>æ™®é€šçš„ app åœ¨ build å®Œä¹‹åï¼Œä¸€èˆ¬æ”¾ç½®åœ¨ <code>$BUILT_PRODUCTS_DIR</code> ä¸­å³å¯ï¼Œè€Œå¯¹äº Xcode Plugin æ¥è¯´ï¼Œåœ¨ build å®Œä¹‹åä¸€èˆ¬ä¼šç›´æ¥å°†å…¶ deploy åˆ° Xcode çš„ <strong>Plug-ins</strong> ç›®å½•ä¸­ï¼Œæ­¤æ—¶ <code>$TARGET_BUILD_DIR</code> å°±æ˜¯ <strong>Plug-ins</strong> ç›®å½•ï¼Œè€Œ <code>$BUILT_PRODUCTS_DIR</code> ä¸­åªæœ‰ Plugin çš„ symbolic linksã€‚</p><p><em>å¯ä»¥ clone ä¸€ä¸‹æˆ‘ä¹‹å‰å†™çš„ä¸€ä¸ª<a href="https://github.com/wzqcongcong/AtAutoCompletion" target="_blank" rel="noopener">å°æ’ä»¶</a>ï¼Œbuild ä¸€ä¸‹çœ‹ç»“æœã€‚</em></p><hr><h4 id="ä¸‹é¢å°±çœ‹ä¸€ä¸‹è¿™-2-ä¸ªè·¯å¾„æ˜¯å¦‚ä½•è®¾ç½®çš„"><a href="#ä¸‹é¢å°±çœ‹ä¸€ä¸‹è¿™-2-ä¸ªè·¯å¾„æ˜¯å¦‚ä½•è®¾ç½®çš„" class="headerlink" title="ä¸‹é¢å°±çœ‹ä¸€ä¸‹è¿™ 2 ä¸ªè·¯å¾„æ˜¯å¦‚ä½•è®¾ç½®çš„"></a>ä¸‹é¢å°±çœ‹ä¸€ä¸‹è¿™ 2 ä¸ªè·¯å¾„æ˜¯å¦‚ä½•è®¾ç½®çš„</h4><p><strong>é¦–å…ˆè§£é‡Šä¸€äº›ç›¸å…³çš„ settingsï¼š</strong></p><p><strong>settingName (settingDisplayNameInXcodeBuildSettings)</strong></p><ul><li><p><strong><code>$SRCROOT</code></strong>ï¼š<code>XXX/ProjectX</code></p></li><li><p><strong><code>$SYMROOT (Build Products Path)</code></strong>ï¼šDirectory path. Identifies the root of the directory hierarchy that contains product files and intermediate build files. Product and build files are placed in subdirectories of this directory. çœ‹å®Œå®˜æ–¹è§£é‡Šï¼Œæˆ‘å†è¯´ä¸€ä¸‹å®ƒå…·ä½“å¦‚ä½•è®¾ç½®ã€‚</p><ol><li><p>é»˜è®¤å€¼æ˜¯ <code>$SRCROOT/build</code></p></li><li><p>å¯ä»¥åœ¨ Xcode çš„ Preferences é‡Œé¢è®¾ç½® <code>Build Location</code>ï¼Œå¦‚ä¸‹å›¾<br><img src="/img/Xcode_Build_Settings_Products_Path/location.png" alt="Build Location"></p></li><li><p>ç›´æ¥åœ¨ Target çš„ <code>Build Settings</code> é‡Œé¢è®¾ç½® <code>Build Products Path</code>ï¼Œå¦‚ä¸‹å›¾<br><img src="/img/Xcode_Build_Settings_Products_Path/build_products_path.png" alt="Build Products Path"></p></li></ol><p>è¿™ 3 ç§è®¾ç½®çš„ä¼˜å…ˆçº§ä¾æ¬¡é€’å¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ åŒæ—¶è®¾ç½®äº† 2 å’Œ 3ï¼Œé‚£ä¹ˆæœ€å build æ˜¯æŒ‰ç…§ 3 çš„å€¼æ¥å¤„ç†çš„ã€‚</p></li><li><p><strong><code>$CONFIGURATION</code></strong>ï¼šDebugã€Releaseã€è‡ªå®šä¹‰çš„ç­‰ç­‰ã€‚</p></li><li><p><strong><code>$CONFIGURATION_BUILD_DIR (Per-Configuration Build Products Path)</code></strong>ï¼š= <code>$SYMROOT/$CONFIGURATION</code>ï¼Œä¾‹å¦‚ <code>XXX/ProjectX/build/Debug</code>ã€‚</p></li><li><p><strong><code>$DEPLOYMENT_LOCATION (Deployment Location)</code></strong>ï¼šBoolean value. Specifies whether product files are placed in the installation or the build directory. å®ƒå†³å®šäº†è¦ä¸è¦å¯¹ <strong>Product Files</strong> è¿›è¡Œ deployã€‚</p></li><li><p><strong><code>$SKIP_INSTALL (Skip Install)</code></strong>ï¼šBoolean value. Specifies whether to place the product at the location indicated by <em><code>$DSTROOT</code></em> or the uninstalled products directory inside the directory indicated by <em><code>$TARGET_TEMP_DIR</code></em>. å®ƒå†³å®šäº†å…·ä½“è¦æŠŠ <strong>Product Files</strong> deploy åˆ°å“ªé‡Œã€‚</p></li></ul><p><strong>ä¸‹é¢å°±è½®åˆ° 2 ä¸ªä¸»è§’äº†ã€‚</strong></p><ul><li><p><strong><code>$BUILT_PRODUCTS_DIR</code></strong>ï¼š= <code>$CONFIGURATION_BUILD_DIR</code> = <code>$SYMROOT/$CONFIGURATION</code> <em>ï¼ˆå…¶å®é™¤äº†è¿™ä¸ªå€¼ï¼Œè¿˜æœ‰ä¸€ç§å–å€¼ï¼Œä¸è¿‡åŸºæœ¬ä¸ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸ºäº†ä¾¿äºç†è§£æŠŠå®ƒå¿½ç•¥äº†ã€‚è¯¦æƒ…å¯æŸ¥é˜…<a href="https://developer.apple.com/library/mac/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/0-Introduction/introduction.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼‰</em></p></li><li><p><strong><code>$TARGET_BUILD_DIR</code></strong>ï¼š</p><ol><li><p>å¦‚æœ <code>$DEPLOYMENT_LOCATION</code> = <code>NO</code>ï¼Œå³ä¸éœ€è¦ deployï¼Œé‚£ä¹ˆ <code>$TARGET_BUILD_DIR</code> å°±ç›´æ¥ç­‰åŒäº <code>$BUILT_PRODUCTS_DIR</code>ã€‚</p></li><li><p>å¦‚æœ <code>$DEPLOYMENT_LOCATION</code> = <code>YES</code>ï¼Œå³éœ€è¦ deployï¼Œé‚£ä¹ˆï¼š</p></li></ol><p>2.1. å¦‚æœ <code>$SKIP_INSTALL</code> = <code>NO</code>ï¼Œé‚£ä¹ˆ <code>$TARGET_BUILD_DIR</code> = <code>$INSTALL_DIR</code> = <code>$DSTROOT/$INSTALL_PATH</code>ã€‚å…¶ä¸­ï¼Œ<code>$DSTROOT</code> çš„ display name æ˜¯ <code>Installation Build Products Location</code>ï¼Œ<code>$INSTALL_PATH</code> çš„ display name æ˜¯ <code>Installation Directory</code>ã€‚å¦å¤–éœ€è¦æ³¨æ„ï¼Œä¸ºäº†æ‹¼æ¥å‡ºä¸€ä¸ªæœ‰æ•ˆçš„ <code>$INSTALL_DIR</code>ï¼Œ<code>$INSTALL_PATH</code> å¿…é¡»ä»¥ <code>/</code> å¼€å¤´ã€‚</p><p>2.2. å¦‚æœ <code>$SKIP_INSTALL</code> = <code>YES</code>ï¼Œé‚£ä¹ˆ <code>$TARGET_BUILD_DIR</code> = <code>$TARGET_TEMP_DIR/UninstalledProducts</code>ã€‚</p><p>ä¸€èˆ¬éœ€è¦ deploy çš„æ—¶å€™ï¼Œéƒ½æ˜¯è®¾ç½® <code>$SKIP_INSTALL</code> ä¸º <code>NO</code>ï¼Œç„¶åè®¾ç½®å…·ä½“çš„ <code>$DSTROOT</code> å’Œ <code>$INSTALL_PATH</code>ï¼Œæ‰€ä»¥è¿™é‡Œå¿½ç•¥å¯¹ <code>$TARGET_TEMP_DIR</code> ç†è§£ã€‚</p></li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‡è®¾ä¸€ä¸ª Project çš„è·¯å¾„æ˜¯ &lt;code&gt;XXX/ProjectX&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“ build å®Œæˆåï¼Œæˆ‘ä»¬ä¼šå…³æ³¨ 2 ä¸ªä¸ &lt;strong&gt;Product Files&lt;/strong&gt; æœ‰å…³çš„ settings ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Xcode" scheme="https://zongquan.wang/tags/Xcode/"/>
    
  </entry>
  
  <entry>
    <title>How to get File Attributes in Mac</title>
    <link href="https://zongquan.wang/2015/01/22/How_to_get_File_Attributes_in_Mac/"/>
    <id>https://zongquan.wang/2015/01/22/How_to_get_File_Attributes_in_Mac/</id>
    <published>2015-01-22T07:16:18.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Mac-File-Attributes"><a href="#Mac-File-Attributes" class="headerlink" title="Mac File Attributes"></a>Mac File Attributes</h4><p>åœ¨ Mac å¼€å‘ä¸­ï¼Œæƒ³è¦è·å– file æˆ–è€… dir çš„å±æ€§ï¼Œæœ‰è¿™ä¹ˆ4ç§æ–¹å¼ï¼š</p><a id="more"></a><ul><li><p><strong>Linux C api</strong></p><p>  <code>int lstat(const char *restrict path, struct stat *restrict buf)</code></p><p>  è·å–åˆ°çš„ stat æœ‰å¦‚ä¸‹å±æ€§ï¼š</p><pre><code>struct stat { /* when _DARWIN_FEATURE_64_BIT_INODE is defined */    dev_t           st_dev;           /* ID of device containing file */    mode_t          st_mode;          /* Mode of file (see below) */    nlink_t         st_nlink;         /* Number of hard links */    ino_t           st_ino;           /* File serial number */    uid_t           st_uid;           /* User ID of the file */    gid_t           st_gid;           /* Group ID of the file */    dev_t           st_rdev;          /* Device ID */    struct timespec st_atimespec;     /* time of last access */    struct timespec st_mtimespec;     /* time of last data modification */    struct timespec st_ctimespec;     /* time of last status change */    struct timespec st_birthtimespec; /* time of file creation(birth) */    off_t           st_size;          /* file size, in bytes */    blkcnt_t        st_blocks;        /* blocks allocated for file */    blksize_t       st_blksize;       /* optimal blocksize for I/O */    uint32_t        st_flags;         /* user defined flags for file */    uint32_t        st_gen;           /* file generation number */};</code></pre></li></ul><ul><li><p><strong>Metadata</strong></p><p>  è¿™ç§æ–¹å¼æ˜¯åŸºäº Spotlight çš„ï¼Œä¼˜ç‚¹æ˜¯åœ¨è®¿é—®å¤§é‡æ–‡ä»¶æ—¶é€Ÿåº¦å¿«ï¼Œç¼ºç‚¹æ˜¯è¦ä¾èµ– Spotlight åŠŸèƒ½çš„å¼€å¯ã€‚å½“ Spotlight è·å–åˆ° item çš„ metadata åï¼Œå°±å¯ä»¥é€šè¿‡ä¸‹é¢2ç§æ–¹æ³•æ¥è·å–è¿™äº› metadataï¼š</p><ul><li><p><code>CFTypeRef MDItemCopyAttribute(MDItemRef item, CFStringRef name)</code>ï¼Œmetadata attribute key æ ¼å¼ä¸º kMDItemXXXï¼Œè¯¦è§æ–‡æ¡£ã€‚</p></li><li><p><code>NSMetadataQuery</code>ï¼Œé€šè¿‡æ‰§è¡Œ Spotlight æŸ¥è¯¢æ¥è·å– resultï¼Œmetadata attribute key æ ¼å¼åŒä¸Šã€‚</p><p><strong>æ³¨æ„</strong>ï¼Œè¿™ç§æ–¹å¼æ˜¯åŸºäº Spotlight è·å–åˆ°äº†è¿™äº› metadataï¼Œå¦åˆ™æ‹¿åˆ°çš„å€¼å¯èƒ½å°±æ˜¯ NULL äº†ã€‚</p><p><strong>å¦å¤–</strong>ï¼Œåœ¨ terminal ä¸­ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæœ‰ç›¸åº”çš„å‘½ä»¤ <code>mdls</code> å¯ä»¥ä½¿ç”¨ã€‚</p></li></ul></li></ul><ul><li><p><strong>NSFileManager</strong></p><p>  é€šè¿‡è°ƒç”¨ NSFileManager çš„ <code>attributesOfItemAtPath:error:</code> ä¹Ÿå¯ä»¥æ‹¿åˆ° file çš„ attributeï¼Œattribute key æ ¼å¼ä¸º <code>NSFileXXX</code>ï¼Œè¯¦è§æ–‡æ¡£ã€‚</p></li></ul><ul><li><p><strong>NSURL</strong></p><p>  é€šè¿‡è°ƒç”¨ NSURL çš„ <code>getResourceValue:forKey:error:</code> ä¹Ÿå¯ä»¥æ‹¿åˆ° file çš„ attributeï¼Œresource key æ ¼å¼ä¸º <code>NSURLXXX</code>ï¼Œè¯¦è§æ–‡æ¡£ã€‚å¯¹æ¯”é‡‡ç”¨ NSFileManagerï¼Œè¿™ç§æ–¹å¼ä»¥ URL çš„å½¢å¼æ¥è®¿é—®è¯¥ fileï¼Œæ‹¿åˆ°çš„ attribute æ¯” NSFileManager ä¹Ÿå¤šã€‚<strong>æ¨èä½¿ç”¨ã€‚</strong></p></li></ul><h4 id="è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹å…³äº-delete-file-dir-çš„ä¸€ç‚¹æ³¨æ„äº‹é¡¹"><a href="#è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹å…³äº-delete-file-dir-çš„ä¸€ç‚¹æ³¨æ„äº‹é¡¹" class="headerlink" title="è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹å…³äº delete file/dir çš„ä¸€ç‚¹æ³¨æ„äº‹é¡¹"></a>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹å…³äº delete file/dir çš„ä¸€ç‚¹æ³¨æ„äº‹é¡¹</h4><p>é¦–å…ˆï¼ŒNSFileManager æœ‰ä¸€ä¸ªåˆ¤æ–­ file/dir èƒ½å¦åˆ é™¤çš„ apiï¼š<code>isDeletableFileAtPath:</code>ï¼Œå…¶æ¬¡ï¼Œè¿˜æœ‰ä¸€ä¸ªè´Ÿè´£åˆ é™¤çš„ apiï¼š<code>removeItemAtPath:error:</code>ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<code>isDeletableFileAtPath:</code> å’Œ <code>removeItemAtPath:error:</code> çš„è¡Œä¸ºä¸å¤ªä¸€è‡´ï¼</p><p><code>removeItemAtPath:error:</code> æ€»æ˜¯èƒ½å¤Ÿåšå‡ºæ­£ç¡®çš„è¡Œä¸ºï¼Œå³èƒ½åˆ é™¤çš„è¯å°±åˆ é™¤ï¼Œä¸èƒ½åˆ é™¤çš„è¯å°±ä¸ä¼šåˆ é™¤ã€‚ä½†æ˜¯ï¼Œ<code>isDeletableFileAtPath:</code> æœ‰æ—¶å€™ä¸èƒ½åšå‡ºæ­£ç¡®çš„åˆ¤æ–­ã€‚</p><ul><li><p>å¯¹äº file æ¥è¯´ï¼Œ<code>isDeletableFileAtPath:</code> æ€»æ˜¯å¯ä»¥åšå‡ºæ­£ç¡®çš„åˆ¤æ–­ï¼Œè¿™ä¸ªæ²¡é—®é¢˜ã€‚</p><p>  ä¹Ÿå°±æ˜¯è¯´ï¼Œæ ¹æ® Apple æ–‡æ¡£ï¼Œå½“ file çš„ parent dir å…·æœ‰å¯å†™æƒé™æ—¶ï¼Œfile å°±æ˜¯ deletable çš„ï¼Œä¸ç®¡ file æœ¬èº«çš„æƒé™å¦‚ä½•ã€‚å¦åˆ™ï¼Œå°±æ˜¯ undeletable çš„ã€‚</p></li><li><p>å¯¹äº dir æ¥è¯´ï¼Œå°±ä¼šå‡ºç°åˆšæ‰è¯´çš„é—®é¢˜ã€‚</p><p>  ç†è®ºä¸Šï¼Œæ ¹æ® Apple æ–‡æ¡£ï¼Œé™¤äº†åˆ¤æ–­ parent dir çš„å¯å†™æƒé™ä¹‹å¤–ï¼Œ<code>isDeletableFileAtPath:</code> è¿˜ä¼šé€’å½’åœ°å»åˆ¤æ–­ child itemï¼Œåªæœ‰æ‰€æœ‰çš„ child item éƒ½æ˜¯ deletable æ—¶ï¼Œæ‰ä¼šè¿”å› YESã€‚</p><p>  ä½†æ˜¯ï¼Œäº‹å®ä¸Šï¼Œ<code>isDeletableFileAtPath:</code> è²Œä¼¼æ²¡æœ‰å»é€’å½’åœ°æ£€æŸ¥ child itemã€‚</p><p>  ä¸¾ä¾‹è¯´æ˜ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ª pathï¼š<user_dir>/<root_dir>/<file_no_matter_root_or_user>ï¼Œpath ä¸­çš„åç§°æ ‡æ˜äº†å¯¹åº”çš„æƒé™ã€‚ç°åœ¨ç”¨ <code>isDeletableFileAtPath:</code> å»æ£€æŸ¥ <root_dir>ã€‚</root_dir></file_no_matter_root_or_user></root_dir></user_dir></p><p>  ç†è®ºä¸Šï¼Œ<root_dir> ä¸­æœ‰ä¸ª <file_no_matter_root_or_user>ï¼Œè€Œ <file_no_matter_root_or_user> æ˜¯ undeletable çš„ï¼ˆå› ä¸ºå®ƒçš„ parent dir <root_dir> æ˜¯ root çš„ï¼Œæ™®é€šç”¨æˆ·æ²¡æœ‰å¯å†™æƒé™ï¼‰ï¼Œæ‰€ä»¥ <root_dir> å°±æ˜¯ undeletable çš„ï¼Œæ‰€ä»¥åº”è¯¥è¿”å› NOã€‚ä½†æ˜¯ <code>isDeletableFileAtPath:</code> è¿”å›çš„å´æ˜¯ YESã€‚æ­¤æ—¶å¦‚æœè°ƒç”¨ <code>removeItemAtPath:error:</code> å»åˆ é™¤ <root_dir> æ—¶ï¼Œå°±ä¼šå‡ºç° errorï¼Œæç¤ºæ²¡æœ‰æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>removeItemAtPath:error:</code> è·Ÿå®é™…æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œä½† <code>isDeletableFileAtPath:</code> å´åšå‡ºäº†é”™è¯¯çš„åˆ¤æ–­ã€‚æ‰€ä»¥å¯¹äºè¿™ç§æƒ…å†µï¼Œä½ éœ€è¦æ‰‹åŠ¨åœ°å»é€’å½’è°ƒç”¨ <code>isDeletableFileAtPath:</code> æ¥æ£€æŸ¥ <root_dir>ã€‚</root_dir></root_dir></root_dir></root_dir></file_no_matter_root_or_user></file_no_matter_root_or_user></root_dir></p><p>  æ„Ÿè§‰å¥½å‘å•Šï¼Œéš¾é“æ‰“å¼€çš„å§¿åŠ¿ä¸å¯¹~~</p></li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Mac-File-Attributes&quot;&gt;&lt;a href=&quot;#Mac-File-Attributes&quot; class=&quot;headerlink&quot; title=&quot;Mac File Attributes&quot;&gt;&lt;/a&gt;Mac File Attributes&lt;/h4&gt;&lt;p&gt;åœ¨ Mac å¼€å‘ä¸­ï¼Œæƒ³è¦è·å– file æˆ–è€… dir çš„å±æ€§ï¼Œæœ‰è¿™ä¹ˆ4ç§æ–¹å¼ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>Just a little tips about Objective-C Block</title>
    <link href="https://zongquan.wang/2014/12/03/Just_a_little_tips_about_Block/"/>
    <id>https://zongquan.wang/2014/12/03/Just_a_little_tips_about_Block/</id>
    <published>2014-12-03T09:35:36.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¤§çˆ± <em><code>Block</code></em>ï¼Œæ–¹ä¾¿æ˜“ç”¨ï¼Œä½†æ˜¯ï¼Œæœ‰äº›å‘è¿˜æ˜¯éœ€è¦è®¤çœŸå¯¹å¾…çš„~~</p><p>å…¶å®é—®é¢˜ä¸»è¦æ˜¯å…³äºå†…å­˜ç®¡ç†çš„ã€‚</p><a id="more"></a><h4 id="1-æ•è·é—­åŒ…çš„çŠ¶æ€"><a href="#1-æ•è·é—­åŒ…çš„çŠ¶æ€" class="headerlink" title="1. æ•è·é—­åŒ…çš„çŠ¶æ€"></a>1. æ•è·é—­åŒ…çš„çŠ¶æ€</h4><p>ä¸€åˆ‡é—®é¢˜çš„èµ·æºï¼š<em><code>Block</code></em> é™¤äº†åŒ…å«ä¸€æ®µå¯æ‰§è¡Œä»£ç ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒè¿˜ä¼šæ•è·ï¼ˆ<em><code>capture</code></em>ï¼‰å…¶é—­åŒ…å†…çš„çŠ¶æ€ã€‚</p><p>ä¾‹ï¼ˆ1ï¼‰ï¼š</p><pre><code>- (void)testMethod {    int a = 1;    void (^testBlock)(void) = ^{        NSLog(@&quot;Integer is: %i&quot;, a);    };    a = 2;    testBlock(); // output is still 1.}</code></pre><p>åœ¨å®šä¹‰ testBlock æ—¶ï¼Œå®ƒä¼šæ•è· a çš„<strong>ç±»å‹ã€å€¼ä»¥åŠä¿®é¥°ç¬¦</strong>ã€‚ä½†æ˜¯ï¼Œæ•è·åªæ„å‘³ç€å¯¹ a åšäº†ä¸€æ¬¡<strong>å¿«ç…§</strong>ï¼Œè€Œå¹¶ä¸æ˜¯çœŸæ­£åœ°æ‹¥æœ‰ aã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å®šä¹‰ testBlock çš„æ—¶å€™ï¼Œå¤–ç•Œ a çš„å€¼æ˜¯å¤šå°‘ï¼Œå®ƒæ•è·è¿›æ¥çš„å€¼å°±æ˜¯å¤šå°‘ã€‚å¤–ç•Œå¯¹ a å€¼çš„ä¿®æ”¹ä¸ä¼šå½±å“åˆ° testBlockï¼ŒåŒæ · testBlock å†…éƒ¨å¯¹ a å€¼çš„ä¿®æ”¹ä¹Ÿä¸ä¼šå½±å“åˆ°å¤–ç•Œã€‚</p><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li><p>æ•è·é—­åŒ…çš„çŠ¶æ€æ˜¯å‘ç”Ÿåœ¨ <em><code>Block</code></em> å®šä¹‰çš„æ—¶å€™ï¼è€Œä¸æ˜¯ <em><code>Block</code></em> çœŸæ­£ run çš„æ—¶å€™ï¼</p></li><li><p>æ•è·çš„æ˜¯<strong>ç±»å‹ + å€¼ + ä¿®é¥°ç¬¦</strong>ï¼Œè€Œä¸å•å•æ˜¯å€¼ï¼</p></li><li><p>å¯¹äºæ ‡é‡æ¥è¯´ï¼Œå› ä¸º <em><code>Block</code></em> åªæ˜¯æ•è·äº†è¯¥å˜é‡çš„å€¼ï¼Œå½“ç„¶æ˜¯æ— æ³•å¯¹å…¶è¿›è¡Œæœ‰æ•ˆåœ°ä¿®æ”¹ã€‚è€Œå¯¹äºå¯¹è±¡æŒ‡é’ˆæ¥è¯´ï¼Œæ•è·è¿›æ¥çš„æ˜¯æŒ‡é’ˆçš„å€¼ï¼Œæ— æ³•ä¿®æ”¹æŒ‡é’ˆçš„å€¼è¡¨ç¤ºä¸èƒ½è®©è¯¥æŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œä½†è¿™ä¸å½±å“ <em><code>Block</code></em> å¯¹è¯¥æŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡è¿›è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¾‹ï¼ˆ1ï¼‰ä¸­çš„ a æ¢æˆä¸€ä¸ªæ•°ç»„æŒ‡é’ˆï¼Œåœ¨ <em><code>Block</code></em> å†…éƒ¨æˆ‘ä»¬æ˜¯å¯ä»¥åšç±»ä¼¼äº <code>[a addObject:]</code> è¿™ç§æ“ä½œçš„ï¼Œå¤–ç•Œå¯ä»¥çœ‹åˆ°å¯¹æŒ‡é’ˆæ‰€æŒ‡å¯¹è±¡çš„ä¿®æ”¹ã€‚å‰ææ˜¯æˆ‘ä»¬è¦åœ¨ <em><code>Block</code></em> å®šä¹‰ä¹‹å‰å°±è¦ç»™ a æ‰€æŒ‡çš„å¯¹è±¡åˆ†é…å¥½å†…å­˜ï¼Œå³åœ¨å¤–ç•Œ <code>NSMutableArray *a = [[NSMutableArray alloc] init]</code>ï¼Œä¹‹ååœ¨ <em><code>Block</code></em> å†…éƒ¨å°±å¯ä»¥ä»»æ„ä¿®æ”¹è¯¥å¯¹è±¡äº†ï¼Œè€Œä¸æ˜¯ä¿®æ”¹è¯¥å¯¹è±¡çš„æŒ‡é’ˆã€‚</p></li></ul><h4 id="2-å¦‚ä½•è®©-Block-è·Ÿå¤–ç•Œå…±äº«æ•è·çš„å†…å®¹"><a href="#2-å¦‚ä½•è®©-Block-è·Ÿå¤–ç•Œå…±äº«æ•è·çš„å†…å®¹" class="headerlink" title="2. å¦‚ä½•è®© Block è·Ÿå¤–ç•Œå…±äº«æ•è·çš„å†…å®¹"></a>2. å¦‚ä½•è®© Block è·Ÿå¤–ç•Œå…±äº«æ•è·çš„å†…å®¹</h4><p>å‰é¢æåˆ°ï¼Œé€šå¸¸ <em><code>Block</code></em> åªæ˜¯å¯¹å˜é‡åšäº†ä¸€ä¸ªå¿«ç…§ï¼Œé‚£ä¹ˆå¦‚ä½•è®© block ä¸å¤–ç•Œå…±äº«è¯¥å˜é‡ï¼Œä»è€Œèƒ½å¤Ÿä¿®æ”¹å…¶æ•è·çš„å€¼å‘¢ï¼Ÿ</p><p>å…¨é  <em><code>__block</code></em> è¿™ä¸ªä¿®é¥°ç¬¦äº†ï¼</p><p>å¦‚æœä¸€ä¸ªå˜é‡åœ¨å£°æ˜çš„æ—¶å€™æŒ‡å®šäº† <em><code>__block</code></em> è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œé‚£å°±æ„å‘³ç€ï¼Œæ‰€æœ‰åœ¨è¯¥å˜é‡çš„ä½œç”¨åŸŸå†…å®šä¹‰çš„ blockï¼Œéƒ½èƒ½å¤Ÿå…±äº«è¯¥å˜é‡ã€‚</p><p>ä¾‹ï¼ˆ2ï¼‰ï¼š</p><pre><code>- (void)testMethod {    __block int a = 1;    void (^testBlock)(void) = ^{        NSLog(@&quot;Integer is: %i&quot;, a);    };    a = 2;    testBlock(); // output is 2 now.}</code></pre><p>è™½ç„¶åœ¨ testBlock å®šä¹‰çš„æ—¶å€™æ•è·åˆ°çš„å€¼æ˜¯1ï¼Œä½† a æ˜¯ <code>__block</code> ä¿®é¥°çš„ï¼Œåœ¨ testBlock run ä¹‹å‰ï¼Œå€¼è¢«æ”¹æˆäº†2ï¼Œæ‰€ä»¥ testBlock run æ—¶èƒ½å¤Ÿå…±äº«åˆ°è¿™ä¸€æ”¹å˜ã€‚åŒæ ·ï¼Œå¦‚æœ testBlock å†…éƒ¨ä¿®æ”¹äº† a çš„å€¼ï¼Œå¤–ç•Œä¹Ÿæ˜¯ä¼šå…±äº«åˆ°çš„ã€‚</p><h4 id="3-å½“-Block-è¢«-copy-æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ"><a href="#3-å½“-Block-è¢«-copy-æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ" class="headerlink" title="3. å½“ Block è¢« copy æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ"></a>3. å½“ Block è¢« copy æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ</h4><p>é¦–å…ˆè¦æ˜ç™½2ç‚¹ï¼Œ<em><code>Block</code></em> ä»€ä¹ˆæ—¶å€™ä¼šè¢« copyï¼Œè¢« copy åˆ°å“ªé‡Œï¼Ÿ</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<em><code>Block</code></em> æ˜¯å­˜å‚¨åœ¨ stack ä¸­çš„ï¼Œå½“å…¶ä» stack å¼¹å‡ºåå°±æ¶ˆå¤±äº†ã€‚ä¾‹å¦‚ä¾‹ï¼ˆ1ï¼‰ï¼ŒtestBlock æ˜¯åœ¨ testMethod çš„ stack ä¸­åˆ›å»ºçš„ï¼Œè‡ªå·± run ç»“æŸåå°±è¢«é”€æ¯äº†ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ<em><code>Block</code></em> ä¸ä¼šå¯¹å…¶æ•è·çš„å˜é‡çš„å†…å­˜ç®¡ç†æˆ–è€…ç”Ÿå‘½å‘¨æœŸæœ‰å½±å“ã€‚</p><p>ä½†å¦‚æœ <em><code>Block</code></em> éœ€è¦è¢«ä¿å­˜ä¸‹æ¥ï¼Œä½¿å…¶åœ¨å®šä¹‰ç»“æŸåçš„å…¶å®ƒä½œç”¨åŸŸä¸‹ runï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥è¢« copy åˆ° <em><code>heap</code></em> ä¸­è¿›è¡Œå­˜å‚¨ã€‚è¿™ä¸ªæ—¶å€™ï¼Œblock è¢«å½“æˆäº† object æ¥çœ‹å¾…ã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„ä¸€ç§æƒ…æ™¯ï¼Œä¾‹ï¼ˆ3ï¼‰ï¼š</p><pre><code>- (void)configureBlock {    self.block = ^{        [self doSomething];    };}</code></pre><p>block è¢«å­˜å‚¨åˆ° self.block ä¸­ä¾›ä»¥åè°ƒç”¨ï¼Œæ˜¾ç„¶æ˜¯è¢« copy åˆ°äº† heap ä¸­ã€‚</p><p><strong>ä¸€æ—¦ block è¢« copyï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼</strong></p><p><em><code>Block</code></em> ä¼šå¯¹æ•è·çš„ self è¿›è¡Œ <em><code>strong reference</code></em>ï¼Œè¿™ææ˜“é€ æˆ <em><code>strong reference cycle</code></em>ã€‚å› ä¸ºå¦‚æœè¯¥ block ä¸é‡Šæ”¾ï¼Œé‚£ä¹ˆ self å°±æ— æ³•é‡Šæ”¾ï¼Œè€Œ block çš„é‡Šæ”¾åˆéœ€è¦ self å…ˆè¢«é‡Šæ”¾ï¼Œdeadlockï¼é™¤éåœ¨ block ç”¨å®Œåï¼Œ<code>self.block = nil</code>ï¼Œå…ˆæŠŠ block é‡Šæ”¾æ‰ã€‚</p><p>åªè¦ block è¢«è¿™æ ·å®šä¹‰ï¼Œä¸ç®¡å®ƒæ˜¯å¦åœ¨ runï¼Œé—®é¢˜éƒ½ä¼šä¸€ç›´å­˜åœ¨ï¼Œå› ä¸ºæ•è·æ˜¯å‘ç”Ÿåœ¨ block å®šä¹‰çš„æ—¶å€™ï¼Œé‚£ä¸ªæ—¶å€™å®ƒå°±è¢« copy åˆ° heap ä¸­äº†ï¼</p><h4 id="4-weakSelf-å’Œ-strongSelf"><a href="#4-weakSelf-å’Œ-strongSelf" class="headerlink" title="4. weakSelf å’Œ strongSelf"></a>4. weakSelf å’Œ strongSelf</h4><p>ä¸ºäº†è§£å†³ä¾‹ï¼ˆ3ï¼‰ä¸­å¯èƒ½çš„ strong reference cycle é—®é¢˜ï¼Œå°±å¼•å…¥äº† <em><code>weakSelf</code></em>ã€‚</p><p>ä¾‹ï¼ˆ4ï¼‰ï¼š</p><pre><code>__weak __typeof__(self) weakSelf = self;dispatch_group_async(_operationsGroup, _operationsQueue, ^ {    [weakSelf doSomething];});</code></pre><p>weakSelf å‘æŒ¥ä½œç”¨çš„å…³é”®åœ¨äºï¼Œ<em><code>Block</code></em> æ•è·çš„æ˜¯<strong>ç±»å‹ + å€¼ + ä¿®é¥°ç¬¦</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šæ•è·åˆ° <code>__weak</code> è¿™ä¸ªä¿®é¥°ç¬¦ï¼è¿™æ · block å°±ä¸ä¼šå¯¹ self è¿›è¡Œ strong referenceã€‚</p><p>é‡‡ç”¨äº† <code>__weak</code> åï¼Œblock åœ¨å®šä¹‰çš„æ—¶å€™ä¸ä¼šå¼ºå¼•ç”¨ selfï¼Œå½“ block åœ¨çœŸæ­£ run çš„æ—¶å€™ï¼ŒweakSelf è¦ä¹ˆæ˜¯ selfï¼Œè¦ä¹ˆæ˜¯ nilã€‚ä¹‹æ‰€ä»¥ä¼šä¸º nilï¼Œæ˜¯å› ä¸ºæ­¤æ—¶ self å¯èƒ½å·²ç»è¢«é‡Šæ”¾äº†ã€‚</p><p>è¿›ä¸€æ­¥ï¼Œè€ƒè™‘ä¾‹ï¼ˆ5ï¼‰ï¼š</p><pre><code>__weak __typeof__(self) weakSelf = self;dispatch_group_async(_operationsGroup, _operationsQueue, ^ {    __typeof__(weakSelf) strongSelf = weakSelf;    [strongSelf doSomething];    [strongSelf doSomethingElse];});</code></pre><p>åˆæ¥äº†ä¸ª <em><code>strongSelf</code></em>ï¼æœ‰ä»€ä¹ˆç”¨å¤„ï¼Ÿ</p><p>æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœæ‰§è¡Œ doSomething æ—¶ï¼Œself è¿˜åœ¨ï¼Œè€Œæ‰§è¡Œ doSomethingElse æ—¶ï¼Œselfè¢«é‡Šæ”¾äº†ï¼Œè¿™æ˜¯ä¸æ˜¯æœ‰ç‚¹ä¸å¦¥~~</p><p>æ‰€ä»¥ block åœ¨ run æ—¶ï¼Œé€šè¿‡å†…éƒ¨çš„ strongSelf å¯¹ self è¿›è¡Œ strong referenceï¼Œè¿™æ ·å¯ä»¥ä¿è¯ï¼Œå¦‚æœ weakSelf åœ¨ block åˆš run æ—¶æ˜¯ selfï¼Œé‚£ä¹ˆåœ¨æ•´ä¸ª run çš„æœŸé—´ä¹Ÿä¸€ç›´æ˜¯ selfï¼Œä¸ä¼šè®© self è¢«é‡Šæ”¾è€Œå˜æˆ nilã€‚</p><p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸ª strongSelf ä¸ä¼šå¯¼è‡´ strong reference cycleï¼Œå› ä¸ºå®ƒä¸æ˜¯åœ¨ block å®šä¹‰çš„æ—¶å€™è¢«æ•è·è¿›æ¥çš„ï¼Œå®ƒåªæ˜¯å±€éƒ¨å˜é‡ï¼Œåªå­˜åœ¨äº block run çš„æœŸé—´ï¼Œå½“ block run ç»“æŸåï¼Œå¯¹ self çš„ strong reference å°±æ¶ˆå¤±äº†ã€‚åªæœ‰ weakSelf æ‰æ˜¯åœ¨å®šä¹‰çš„æ—¶å€™è¢«æ•è·è¿›æ¥çš„ï¼Œè€Œå®ƒåˆæ˜¯ <code>__weak</code> çš„ã€‚</p><p>å…³äº weakSelf å’Œ strongSelfï¼Œæœ‰2ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©ç†è§£ï¼š<a href="http://www.fantageek.com/1090/understanding-weak-self-and-strong-self/" target="_blank" rel="noopener">ã€1ã€‘</a> <a href="http://dhoerl.wordpress.com/2013/04/23/i-finally-figured-out-weakself-and-strongself/" target="_blank" rel="noopener">ã€2ã€‘</a></p><h4 id="5-è¡¥å……"><a href="#5-è¡¥å……" class="headerlink" title="5. è¡¥å……"></a>5. è¡¥å……</h4><ul><li><p>dispatch_async å¯¹ block çš„å¤„ç†ï¼šä¼šå°† block copy åˆ° heap ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯éœ€è¦å¼‚æ­¥å¤„ç†çš„ï¼Œæ‰€ä»¥éœ€è¦å°† block å­˜å‚¨ä¸‹æ¥ã€‚</p></li><li><p>dispatch_sync å¯¹ block çš„å¤„ç†ï¼šç”±äºæ˜¯åŒæ­¥å¤„ç†çš„ï¼Œæ‰€ä»¥ block åªå­˜åœ¨äºå½“å‰çš„ stack ä¸­ï¼Œrun å®Œå°±é‡Šæ”¾äº†ï¼Œä¸ä¼šè¢«å­˜å‚¨åœ¨ heap ä¸­ã€‚</p></li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤§çˆ± &lt;em&gt;&lt;code&gt;Block&lt;/code&gt;&lt;/em&gt;ï¼Œæ–¹ä¾¿æ˜“ç”¨ï¼Œä½†æ˜¯ï¼Œæœ‰äº›å‘è¿˜æ˜¯éœ€è¦è®¤çœŸå¯¹å¾…çš„~~&lt;/p&gt;
&lt;p&gt;å…¶å®é—®é¢˜ä¸»è¦æ˜¯å…³äºå†…å­˜ç®¡ç†çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>XPC mechanism of Mac</title>
    <link href="https://zongquan.wang/2014/11/28/XPC_mechanism_of_Mac/"/>
    <id>https://zongquan.wang/2014/11/28/XPC_mechanism_of_Mac/</id>
    <published>2014-11-27T16:44:50.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Mac ä¸­ï¼Œè¿›ç¨‹é—´çš„é€šä¿¡æœºåˆ¶ï¼Œé™¤äº† <em><code>NSDistributedNotification</code></em>ã€<em><code>Distributed Objects</code></em>ï¼Œè¿˜æœ‰ XPCã€‚XPC å¯ä»¥åœ¨åŒä¸€ä¸ª app çš„ä¸åŒ bundle é—´ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„ app é—´ä½¿ç”¨ã€‚</p><a id="more"></a><p>XPC æœºåˆ¶æ˜¯é€šè¿‡ <em><code>NSXPCConnection</code></em> ä½œä¸º channel æ¥é€šä¿¡çš„ï¼Œæ¯ä¸ª <em><code>NSXPCConnection</code></em> æœ‰ <em>Client</em> å’Œ <em>Listener</em> ä¸¤ä¸ª endpointã€‚</p><h3 id="1-XPC-è§’è‰²"><a href="#1-XPC-è§’è‰²" class="headerlink" title="1. XPC è§’è‰²"></a>1. XPC è§’è‰²</h3><h4 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h4><p>é€šè¿‡ <em><code>NSXPCListener</code></em> API æ¥åˆ›å»º Listenerï¼Œå¹¶æŒ‡å®šè¯¥ Listener çš„ <em><code>NSXPCListenerDelegate</code></em>ï¼Œè¯¥ delegate éœ€è¦å®ç°çš„å‡½æ•°æ˜¯ <em><code>(BOOL)listener:shouldAcceptNewConnection:</code></em>ã€‚è¯¥ delegate å‡½æ•°ç”¨äºå†³å®šæ˜¯å¦å“åº”æ–°çš„ connectionï¼Œå¹¶è®¾ç½®è¯¥ connection çš„ <em><code>exportedInterface</code></em> å’Œ <em><code>exportedObject</code></em>ã€‚</p><ul><li><p><em><code>exportedObject</code></em>ï¼šListener çš„å¯¼å‡ºå¯¹è±¡ï¼Œæä¾›æ¥å£ä¾› Client è®¿é—®ã€‚</p></li><li><p><em><code>exportedInterface</code></em>ï¼šåˆ—ä¸¾å‡º <em><code>exportedObject</code></em> èƒ½å¤Ÿå¯¼å‡ºå“ªäº›å¯ç”¨çš„æ¥å£ä¾› Client è°ƒç”¨ï¼Œå‡½æ•°åŸå‹é€šå¸¸æ˜¯ï¼š<em>`(void)doTaskWithInfo:(NSDictionary </em>)info callback:(void(^)(NSDictionary <em>dic))callback`</em>ã€‚</p></li></ul><h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><p>Client é€šè¿‡ <em><code>NSXPCConnection</code></em> API æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ connectionï¼Œå¹¶æŒ‡å®šè¯¥ connection çš„ <em><code>remoteObjectInterface</code></em>ï¼Œå®ƒä»£è¡¨ Listener ç«¯çš„ <em><code>exportedInterface</code></em>ã€‚ç„¶åå°±å¯ä»¥é€šè¿‡ <em><code>remoteObjectProxyWithErrorHandler:</code></em> æ¥è·å– Listener ç«¯çš„ <em><code>exportedObject</code></em>ï¼Œè°ƒç”¨å…¶å¯¼å‡ºçš„æ¥å£ã€‚Listener åœ¨æ‰§è¡Œè‡ªå·±çš„å¯¼å‡ºå‡½æ•°æ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ä¼ é€’è¿›æ¥çš„ callback å‘ Client ç«¯ send back æ•°æ®ã€‚</p><h4 id="NSXPCConnection"><a href="#NSXPCConnection" class="headerlink" title="NSXPCConnection"></a>NSXPCConnection</h4><p><em><code>NSXPCConnection</code></em> çš„å‘èµ·æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”± Client ç«¯åˆ° Listener ç«¯ï¼Œå› ä¸ºæ¯ä¸€ä¸ªå‘èµ·çš„ connection å¿…é¡»è¦ç”± Listener ç«¯é€šè¿‡ <em><code>NSXPCListenerDelegate</code></em> å‡½æ•°æ¥å†³å®šæ˜¯å¦è¦è¿›è¡Œå“åº”ã€‚ä½† Client å’Œ Listener éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ <em><code>exportedObject</code></em> å’Œ <em><code>remoteObjectProxy</code></em>ï¼Œåœ¨ connect ä¹‹åå¯ä»¥ç›¸äº’è®¿é—®å¯¹æ–¹ï¼Œä¸€æ–¹çš„ <em><code>exportedObject</code></em> å¯¹åº”å¦ä¸€æ–¹çš„ <em><code>remoteObjectProxy</code></em>ã€‚å‚è§ Apple æ–‡æ¡£ä¸­çš„å›¾ç¤ºã€‚</p><p><strong>æ³¨æ„</strong>ï¼šä¸ç®¡æ˜¯ Client è¿˜æ˜¯ Listenerï¼Œè®¾ç½®è‡ªå·±çš„ <em><code>exportedObject</code></em> å’Œ <em><code>remoteObjectProxy</code></em> å¿…é¡»è¦å…ˆäºè°ƒç”¨ <em><code>resume</code></em>ã€‚</p><h3 id="2-XPC-æ­å»º"><a href="#2-XPC-æ­å»º" class="headerlink" title="2. XPC æ­å»º"></a>2. XPC æ­å»º</h3><ul><li><p>åŒä¸€ä¸ª app ä¸­ä½¿ç”¨çš„ XPC ç§°ä¸º XPC Serviceï¼Œåœ¨ Xcode ä¸­å¯ä»¥åˆ›å»º <em>XPC Service</em> è¿™ç§ targetï¼Œç”Ÿæˆçš„ bundle æ˜¯ .xpcã€‚åœ¨ä¸» app ä¸­éœ€è¦å°† .xpc bundle deploy åˆ°è‡ªå·±çš„ <em><code>Contents/XPCServices</code></em> ç›®å½•ä¸‹ï¼ŒMac ä¼šåœ¨è¯¥ç›®å½•ä¸­å¯»æ‰¾ç›¸åº”çš„ .xpc bundle å» loadã€‚</p><p>  <strong>Listener</strong>ï¼šåœ¨ <em>XPC Service</em> bundle çš„ä»£ç ä¸­ï¼Œéœ€è¦ä½¿ç”¨ <em><code>[NSXPCListener serviceListener]</code></em> æ¥åˆ›å»º Listenerã€‚æ‰§è¡Œ <em><code>resume</code></em> ä¹‹åæ°¸è¿œä¸ä¼š returnã€‚</p><p>  <strong>Client</strong>ï¼šåœ¨ Client ç«¯ï¼Œä¹Ÿå°±æ˜¯ä¸» app ä¸­ï¼Œéœ€è¦ä½¿ç”¨ <em><code>[[NSXPCConnection alloc]   initWithServiceName:]</code></em> æ¥åˆ›å»º connectionï¼Œä¸ºå…¶ä¼ é€’ <em>XPC Service</em> çš„ Bundle IDã€‚</p><p>   <strong>æ³¨æ„</strong>ï¼š<em>XPC Service</em> çš„å¯åŠ¨æˆ–è€…é€€å‡ºå®Œå…¨ç”± OS è‡ªå·±å†³å®šï¼Œä½ è¦åšçš„å°±æ˜¯å¯åŠ¨ä¸» appï¼Œå¹¶åœ¨ä»£ç ä¸­éœ€è¦çš„åœ°æ–¹è¯·æ±‚ XPC connectionã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ.xpc bundle å¯èƒ½æ˜¯åœ¨ä¸» app å‘èµ· XPC è¯·æ±‚æ—¶æ‰è¢« load å’Œå¯åŠ¨ XPC Serviceï¼Œè€Œä¸æ˜¯æ—©åœ¨ä¹‹å‰å°±å»å¯åŠ¨ã€‚æ­¤å¤–ï¼Œ<em><code>Contents/XPCServices</code></em> ç›®å½•ä¸‹çš„ .xpc bundle åªèƒ½ç”±æ‰€å±çš„ä¸» app è°ƒç”¨ï¼Œå…¶å®ƒ app æ— æ³•è°ƒç”¨ã€‚</p><p>   <strong>e.g.</strong></p><pre><code>Apple&apos;s sample code: [SandboxingAndNSXPCConnection]Apple&apos;s sample code: [AppSandboxLoginItemXPCDemo]</code></pre></li><li><p>ä¸åŒ app é—´çš„ XPC ä¸æ˜¯é€šè¿‡åˆ›å»º .xpc bundle æ¥å®ç°çš„ï¼Œå› ä¸ºå‰é¢è¿™ç§æ–¹å¼åˆ›å»ºçš„ .xpc bundle åªèƒ½è¢«è‡ªå·±æ‰€å±çš„ app è°ƒç”¨ã€‚è€Œæ˜¯é€šè¿‡åˆ›å»ºæ™®é€šçš„ target æ¥å……å½“ XPC çš„Listenerã€‚</p><p>  <strong>Listener</strong>ï¼šåœ¨ Listener app ä¸­ï¼Œéœ€è¦ä½¿ç”¨ <em><code>[[NSXPCListener alloc] initWithMachServiceName:]</code></em> æ¥åˆ›å»º Listenerï¼Œä¸ºå…¶ä¼ é€’è‡ªè¡Œè®¾å®šçš„ XPC service nameã€‚æ‰§è¡Œ <em><code>resume</code></em> ä¹‹åä¼šç«‹å³ returnï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡Œå¯åŠ¨ Runloopã€‚</p><p>  <strong>Client</strong>ï¼šåœ¨ Client app ä¸­ï¼Œéœ€è¦ä½¿ç”¨ <em><code>[[NSXPCConnection alloc] initWithMachServiceName:options:]</code></em> æ¥åˆ›å»º connectionï¼Œä¸ºå…¶ä¼ é€’ Listener ä¸­æŒ‡å®šçš„ XPC service nameã€‚option ç”¨äºè¯´æ˜ä½ çš„ XPC service æ˜¯å¦æ˜¯åœ¨ admin æƒé™ä¸‹ã€‚</p><p>  <strong>e.g.</strong> <a href="https://github.com/wzqcongcong/SMJobBlessXPC" target="_blank" rel="noopener">SMJobBlessXPC</a> | <a href="https://github.com/wzqcongcong/MyDiskCleaner" target="_blank" rel="noopener">MyDiskCleaner</a> | <a href="https://github.com/wzqcongcong/AppleTunerUpdater" target="_blank" rel="noopener">AppleTunerUpdater</a></p></li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ Mac ä¸­ï¼Œè¿›ç¨‹é—´çš„é€šä¿¡æœºåˆ¶ï¼Œé™¤äº† &lt;em&gt;&lt;code&gt;NSDistributedNotification&lt;/code&gt;&lt;/em&gt;ã€&lt;em&gt;&lt;code&gt;Distributed Objects&lt;/code&gt;&lt;/em&gt;ï¼Œè¿˜æœ‰ XPCã€‚XPC å¯ä»¥åœ¨åŒä¸€ä¸ª app çš„ä¸åŒ bundle é—´ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„ app é—´ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>Communications between sandbox apps in Mac</title>
    <link href="https://zongquan.wang/2014/11/28/Communications_between_sandbox_apps_in_Mac/"/>
    <id>https://zongquan.wang/2014/11/28/Communications_between_sandbox_apps_in_Mac/</id>
    <published>2014-11-27T16:44:04.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äº Mac å¯¹ Sandbox çš„ç§ç§é™åˆ¶ï¼Œä½¿å¾— Sandb app é—´çš„é€šä¿¡æ–¹å¼ä¸æ™®é€š non Sandbox app é—´çš„é€šä¿¡æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œæ™®é€šçš„é€šä¿¡æ–¹å¼ï¼Œå¦‚ <em><code>NSDistributedNotification</code></em>ã€<em><code>Distributed Objects</code></em>ã€ <em><code>XPC</code></em> ç­‰ä¸èƒ½ç›´æ¥å¥—ç”¨åˆ° Sandbox æœºåˆ¶ä¸Šã€‚</p><a id="more"></a><p>Mac å¼•å…¥äº† <em><code>Sandbox App Group</code></em> çš„æœºåˆ¶ï¼Œä½¿å¾—åŒå±äºä¸€ä¸ª app group çš„ä¸åŒ app é—´æœ‰äº†åˆé€‚çš„é€šä¿¡æ–¹å¼ã€‚</p><h3 id="Sandbox-App-Group-æ˜¯ä»€ä¹ˆ"><a href="#Sandbox-App-Group-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Sandbox App Group æ˜¯ä»€ä¹ˆ"></a>Sandbox App Group æ˜¯ä»€ä¹ˆ</h3><p>Sandbox App Group è¡¨ç¤ºç”±åŒä¸€ä¸ª Developer ID ç­¾åçš„ app groupã€‚æ¯ä¸ª Developer ID å¯ä»¥ç­¾åå¤šä¸ª Sandbox App Groupï¼Œæ¯ä¸ª Sandbox App Group å¯ä»¥åŒ…å«è‹¥å¹²ä¸ª Sandbox appã€‚</p><p>å¦‚æœæƒ³è¦å£°æ˜ä¸€ä¸ª Sandbox app å±äºæŸä¸ª Sandbox App Groupï¼Œéœ€è¦åœ¨è¯¥ app çš„ <em><code>.entitlements</code></em> ä¸­æ·»åŠ ä¸€ä¸ª <em><code>com.apple.security.application-groups</code></em> arrayï¼Œå®ƒçš„æ¯ä¸ªå…ƒç´ è¡¨ç¤ºè¯¥ app å±äºçš„æŸä¸ª Sandbox app groupï¼Œç”¨ Group Bundle ID è¡¨ç¤ºã€‚</p><p><strong><code>Group Bundle ID</code></strong> := <team-id>.com.company.XXXï¼Œ<team-id> å…¶å®ä¹Ÿå¯ä»¥ä¸ç”¨ï¼Œä½† Apple çš„æ ‡å‡†ç”¨æ³•æ˜¯ä»¥ <team-id> ä½œä¸º Group Bundle ID çš„ prefixã€‚</team-id></team-id></team-id></p><p>æ¯ä¸ª Sandbox App Group ä¼šåœ¨ <em><code>~/Library/Group Containers</code></em> ä¸‹ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ç›®å½•ï¼Œä»¥ Group Bundle ID å‘½åã€‚è¯¥ç›®å½•çš„ç»“æ„ä¸ Sandbox app çš„ Container ç›®å½•ç»“æ„ç›¸åŒã€‚è¯¥ç›®å½•å¯ä»¥è¢«å±äºè¯¥ group çš„æ‰€æœ‰ Sandbox app è®¿é—®ï¼Œæ²¡æœ‰é™åˆ¶ã€‚è®¿é—®è¯¥ç›®å½•çš„æ–¹æ³•æ˜¯è°ƒç”¨ <em><code>[[NSFileManager defaultManager] containerURLForSecurityApplicationGroupIdentifier:]</code></em>ã€‚</p><h3 id="Sandbox-App-Group-èƒ½å¤Ÿåšä»€ä¹ˆ"><a href="#Sandbox-App-Group-èƒ½å¤Ÿåšä»€ä¹ˆ" class="headerlink" title="Sandbox App Group èƒ½å¤Ÿåšä»€ä¹ˆ"></a>Sandbox App Group èƒ½å¤Ÿåšä»€ä¹ˆ</h3><p>å€ŸåŠ© Sandbox App Groupï¼Œæœ‰ä»¥ä¸‹è¿™ä¹ˆå‡ ç§æ–¹å¼å¯ä»¥ç”¨æ¥å®ç°åŒ group ä¸‹çš„ app é—´çš„é€šä¿¡ã€‚</p><h4 id="1-NSUserDefaults"><a href="#1-NSUserDefaults" class="headerlink" title="1. NSUserDefaults"></a>1. NSUserDefaults</h4><p>å¯¹äºå•ä¸ª Sandbox app æ¥è¯´ï¼Œå®ƒçš„ <em><code>NSUserDefaults</code></em> åªèƒ½ç”±è‡ªå·±è®¿é—®ï¼Œåˆ«çš„ Sandbox app æ— æ³•è®¿é—®ã€‚è€Œæœ‰äº† Sandbox App Groupï¼Œæ¯ä¸ª group å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ <em><code>NSUserDefaults</code></em>ï¼Œè€Œå®ƒæ˜¯å¯ä»¥è¢«ä¸‹å±çš„æ‰€æœ‰ Sandbox app å…±äº«è®¿é—®çš„ã€‚</p><ul><li><p>åˆ›å»º Group User Defaults</p><pre><code>NSUserDefaults *defaults = [[NSUserDefaults alloc] init];[defaults addSuiteNamed:&lt;Group Bundle ID&gt;];</code></pre></li><li><p>Get</p><pre><code>[defaults persistentDomainForName:];</code></pre></li><li><p>Set</p><pre><code>[defaults setPersistentDomain: forName:]</code></pre></li></ul><p>å…³äº <em><code>NSUserDefaults</code></em>ï¼Œæœ‰ä¸€ç¯‡ <a href="http://realmacsoftware.com/blog/shared-preferences-between-sandboxed-applications" target="_blank" rel="noopener">å¾ˆ NB çš„æ–‡ç« </a> å¯ä»¥å­¦ä¹ ã€‚</p><p><strong>e.g.</strong> <a href="https://github.com/wzqcongcong/MyDiskCleaner" target="_blank" rel="noopener">MyDiskCleaner</a></p><h4 id="2-Group-Containers-ç›®å½•"><a href="#2-Group-Containers-ç›®å½•" class="headerlink" title="2. Group Containers ç›®å½•"></a>2. Group Containers ç›®å½•</h4><p>å°½æƒ…åˆ©ç”¨å§ã€‚å°½æƒ…è¯»å†™å§ã€‚</p><p>æ¯”å¦‚ç”¨ <em><code>FSEventStreamRef</code></em> æ¥ç›‘æ§å…¶ä¸‹çš„æŸä¸ªç›®å½•ï¼Œä»è€Œå°†è¯¥ç›®å½•çš„å˜åŒ–é€šçŸ¥åˆ°ä¸åŒçš„ Sandbox app ã€‚è™½ç„¶è¿™ç§é€šä¿¡æ–¹å¼æœ‰ç‚¹åŸå§‹~~</p><p>å…¶å® <em><code>NSUserDefaults</code></em> æœ¬è´¨ä¸Šå°±æ˜¯å­˜åœ¨äº Group Containers é‡Œçš„ Preferences ç›®å½•ä¸­ã€‚</p><p><strong>e.g.</strong> <a href="https://github.com/wzqcongcong/MyDiskCleaner" target="_blank" rel="noopener">MyDiskCleaner</a></p><h4 id="3-XPC"><a href="#3-XPC" class="headerlink" title="3. XPC"></a>3. XPC</h4><p>æ˜¯çš„ï¼Œæœ‰äº† Sandbox App Groupï¼ŒSandbox app é—´å¯ä»¥ä½¿ç”¨ XPC äº†ã€‚<br>ä½†ä½¿ç”¨æ–¹å¼éœ€è¦æœ‰æ‰€æ³¨æ„ã€‚</p><p><strong>ä½¿ç”¨æ¡ä»¶</strong>ï¼š</p><ul><li><p>XPC Listener å¿…é¡»æ˜¯ä½äº Helper app ä¸­ï¼Œç”±ä¸» app é€šè¿‡ <em><code>SMLoginItemSetEnabled</code></em> æ¥å¯åŠ¨è¯¥ Helper appï¼Œä»è€Œå¯åŠ¨ XPC Listenerã€‚</p></li><li><p>Helper app çš„ Bundle ID å¿…é¡»ä»¥ Group Bundle ID ä½œä¸º prefixï¼Œå³ <strong><code>Helper Bundle ID</code></strong> := <group-bundle-id>.XXX</group-bundle-id></p></li><li><p>Helper app åœ¨åˆ›å»º Listener æ—¶éœ€è¦ä½¿ç”¨ <em><code>[[NSXPCListener alloc] initWithMachServiceName:]</code></em>ï¼Œä¸» app åœ¨åˆ›å»º connection æ—¶éœ€è¦ä½¿ç”¨ <em><code>[[NSXPCConnection alloc] initWithMachServiceName:options:0]</code></em>ã€‚</p></li><li><p>XPC service name å¿…é¡»ç­‰äº Helper Bundle IDã€‚å› ä¸ºå®é™…ä¸Šæ˜¯ï¼Œåœ¨è°ƒç”¨ <em><code>SMLoginItemSetEnabled</code></em> å¯åŠ¨Helper app åï¼ŒLaunchServices è‡ªåŠ¨ä¸ºå…¶æ³¨å†Œäº†ä¸€ä¸ª XPC serviceï¼Œè€Œ name å°±æ˜¯ Helper Bundle IDã€‚</p></li></ul><p><strong>e.g.</strong> Apple Demo <em>â€œAppSandboxLoginItemXPCDemoâ€</em></p><h4 id="4-Distributed-Objects"><a href="#4-Distributed-Objects" class="headerlink" title="4. Distributed Objects"></a>4. Distributed Objects</h4><p>è·Ÿ XPC ç±»ä¼¼ï¼Œå¯¹ Distributed Objects åŠ äº›ç‰¹æ®Šè®¾ç½®ï¼Œå®ƒä¹Ÿå¯ä»¥å€ŸåŠ© Sandbox App Group æ¥å®ç° Sandbox app é—´çš„é€šä¿¡ã€‚</p><p><strong>ä½¿ç”¨æ¡ä»¶</strong>ï¼š</p><ul><li><p>DOServer ç«¯è¦ä½¿ç”¨ <em><code>NSMachPort</code></em> æ¥åˆ›å»º Mach Portã€‚</p></li><li><p>DOServer ç«¯è¦ä½¿ç”¨ <em><code>[[NSConnection alloc] initWithReceivePort: sendPort:]</code></em> æ¥åˆå§‹åŒ– connectionï¼ˆä»¥åéœ€è¦å¯¹è¯¥ connection è®¾ç½® rootObjectï¼Œä¹Ÿå°±æ˜¯ DOClient ç«¯èƒ½å¤Ÿè®¿é—®çš„ DOï¼‰ï¼Œç»™å®ƒä¼ é€’ä¹‹å‰åˆ›å»ºçš„ Mach Portã€‚ä¸è¦ä½¿ç”¨ <em><code>[NSConnection defaultConnection]</code></em>ã€‚</p></li><li><p>DOServer ç«¯è¦ä½¿ç”¨ <em><code>[[NSMachBootstrapServer sharedInstance] registerPort:name:]</code></em> æ¥æ³¨å†Œåˆšåˆ›å»ºçš„ Mach Portï¼Œæ³¨å†Œç”¨çš„ name å¿…é¡»ä»¥ Group Bundle ID ä½œä¸º prefixï¼Œåè·Ÿè‡ªå®šä¹‰çš„ port åç§°ã€‚</p><p>  <strong>æ³¨æ„</strong>ï¼Œå¦‚æœ DOServer ç«¯ä½äº <em><code>SMLoginItemSetEnabled</code></em> å¯åŠ¨çš„ Helper appï¼Œé‚£ä¹ˆå®šä¹‰çš„ Mach Port name ä¸èƒ½å’Œè¯¥ Helper app çš„ Bundle ID åŒåï¼Œå› ä¸ºå…¶ Bundle ID å·²ç»è¢« Mac è‡ªåŠ¨ç”¨äºæ³¨å†Œ XPC Service nameï¼Œä¼šå¯¼è‡´è¿™é‡Œçš„ DO Mach Port name æ³¨å†Œå¤±è´¥ã€‚</p></li><li><p>DOClient ç«¯è¦ä½¿ç”¨ <em><code>[NSConnection connectionWithRegisteredName: host:nil]</code></em> æ¥è¿æ¥ DOServer ç«¯ï¼Œæ³¨å†Œ name å°±ç”¨ä¹‹å‰ DOServer ç«¯è®¾ç½®çš„ Mach Port nameã€‚</p></li></ul><p><strong>e.g.</strong> <a href="https://github.com/wzqcongcong/MyDiskCleaner" target="_blank" rel="noopener">MyDiskCleaner</a></p><h3 id="é™¤äº†-Sandbox-App-Groupï¼Œè¿˜æœ‰ä»€ä¹ˆï¼Ÿ"><a href="#é™¤äº†-Sandbox-App-Groupï¼Œè¿˜æœ‰ä»€ä¹ˆï¼Ÿ" class="headerlink" title="é™¤äº† Sandbox App Groupï¼Œè¿˜æœ‰ä»€ä¹ˆï¼Ÿ"></a>é™¤äº† Sandbox App Groupï¼Œè¿˜æœ‰ä»€ä¹ˆï¼Ÿ</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ iOS app ä¸­ï¼Œæœ‰ <em><code>URL Scheme</code></em> è¿™ä¹ˆä¸ªæœºåˆ¶ã€‚å¦‚æœæŸä¸ª app æ³¨å†Œäº†æŸä¸ªç‰¹æ®Šçš„ <em><code>URL Scheme</code></em>ï¼Œé‚£ä¹ˆå…¶ä»– app å¯ä»¥é€šè¿‡è®¿é—® URL çš„å½¢å¼æ¥ launch è¯¥ appã€‚</p><p>iOS app ä¹Ÿæ˜¯é‡‡ç”¨ Sandbox æœºåˆ¶çš„ï¼Œé‚£ä¹ˆåœ¨ Mac ä¸Šï¼Œè¯¥æ–¹æ³•ä¹Ÿæ˜¯åŒæ ·é€‚ç”¨çš„ï¼ä¸ç®¡å…¶ä»– app æ˜¯ä¸æ˜¯å±äºåŒä¸€ Sandbox App Groupï¼Œéƒ½å¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥ launch è¯¥ appï¼Œå¹¶å°†è®¿é—®çš„ URL ä¼ é€’ç»™è¯¥ appã€‚è€Œå¦‚æœè¯¥ app å·²ç»å¯åŠ¨ï¼Œé‚£ä¹ˆå®ƒåŒæ ·ä¹Ÿä¼šæ•æ‰åˆ°è¢«è®¿é—®çš„ URLï¼Œä»è€Œåšå‡ºå“åº”ã€‚</p><ul><li><p>è®© app æ³¨å†Œ URL Scheme</p><p>  åœ¨æœ¬ app çš„ Info.plsit ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª <em><code>URL types</code></em> arrayï¼Œå®ƒçš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ª <em><code>URL Schemes</code></em> arrayï¼Œè€Œè¯¥ array çš„æ¯ä¸ªå…ƒç´ å°±æ˜¯ä¸€ä¸ª URL Schemeï¼Œé€šå¸¸å–ä¸€ä¸ªç‰¹æ®Šçš„åå­—ï¼Œç”¨äºåŒºåˆ«å…¶å®ƒ app çš„ URL Schemesã€‚</p></li><li><p>ç›‘å¬è‡ªå·±æ³¨å†Œçš„ URL Scheme</p><p>  åœ¨æœ¬ app çš„ <em><code>applicationWillFinishLaunching:</code></em> delegate å‡½æ•°ä¸­ï¼Œåˆ©ç”¨å¦‚ä¸‹ä»£ç æ³¨å†Œä¸€ä¸ªç³»ç»Ÿ event listenerï¼š</p><pre><code>[[NSAppleEventManager sharedAppleEventManager] setEventHandler:andSelector:forEventClass:andEventID:];</code></pre><p>  callback å‡½æ•°ï¼š</p><pre><code>-(void)getUrl:(NSAppleEventDescriptor *)event withReplyEvent:(NSAppleEventDescriptor*)reply{    NSURL *url = [NSURL URLWithString:[[event paramDescriptorForKeyword:keyDirectObject] stringValue]];    ...}</code></pre><p>  <strong>æ³¨æ„</strong>ï¼šå¿…é¡»è¦åœ¨ <em><code>applicationWillFinishLaunching:</code></em> ä¸­æ³¨å†Œï¼Œå¦åˆ™é€šè¿‡è¿™ç§æ–¹å¼å¯åŠ¨ app åï¼Œå®ƒæ— æ³•è·å–è¢«è®¿é—®çš„ URL ä¿¡æ¯ã€‚</p></li><li><p>å…¶å®ƒ app è®¿é—®è¯¥ URL Scheme</p><p>  åœ¨å…¶å®ƒ app ä¸­ï¼Œæ„é€  URL å¹¶è®¿é—®ï¼š</p><pre><code>[[NSWorkspace sharedWorkspace] openURL:[[NSURL alloc] initWithScheme:host:path:]];</code></pre></li></ul><p><strong>e.g.</strong> <a href="https://github.com/wzqcongcong/MyDiskCleaner" target="_blank" rel="noopener">MyDiskCleaner</a></p><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”±äº Mac å¯¹ Sandbox çš„ç§ç§é™åˆ¶ï¼Œä½¿å¾— Sandb app é—´çš„é€šä¿¡æ–¹å¼ä¸æ™®é€š non Sandbox app é—´çš„é€šä¿¡æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œæ™®é€šçš„é€šä¿¡æ–¹å¼ï¼Œå¦‚ &lt;em&gt;&lt;code&gt;NSDistributedNotification&lt;/code&gt;&lt;/em&gt;ã€&lt;em&gt;&lt;code&gt;Distributed Objects&lt;/code&gt;&lt;/em&gt;ã€ &lt;em&gt;&lt;code&gt;XPC&lt;/code&gt;&lt;/em&gt; ç­‰ä¸èƒ½ç›´æ¥å¥—ç”¨åˆ° Sandbox æœºåˆ¶ä¸Šã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>How to add Login item for Mac</title>
    <link href="https://zongquan.wang/2014/11/27/How_to_add_Login_item_for_Mac/"/>
    <id>https://zongquan.wang/2014/11/27/How_to_add_Login_item_for_Mac/</id>
    <published>2014-11-27T14:35:05.000Z</published>
    <updated>2017-11-02T12:04:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Mac OS ä¸­ï¼Œæœ‰è®¸å¤šæœºåˆ¶å¯ä»¥ç”¨äºæ·»åŠ  Login itemï¼Œä¸åŒçš„ Login item ç±»å‹éœ€è¦ç”¨ä¸åŒçš„æ–¹å¼æ¥æ·»åŠ ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰è‡ªå·±çš„å·¥ä½œæµç¨‹ï¼Œåº”ç”¨èŒƒå›´ï¼Œä»¥åŠæœ€ç»ˆçš„è¡¨ç°æ•ˆæœã€‚</p><a id="more"></a><p>ä»å¼€å‘è€…çš„è§’åº¦æ¥çœ‹ï¼Œå¯ä»¥åˆ†æˆä¸¤å¤§ç±»ï¼Œ<strong>ä¸€ç±»</strong>æ˜¯åœ¨ä»£ç ä¸­é€šè¿‡è°ƒç”¨ Mac çš„ API æ¥æ·»åŠ ï¼Œç”± Mac æ¥è‡ªåŠ¨ç®¡ç† Login itemï¼›<strong>å¦ä¸€ç±»</strong>æ˜¯å¼€å‘è€…ç›´æ¥æ‹¿ File System å¼€åˆ€ï¼Œæ‰‹åŠ¨æ§åˆ¶ã€‚</p><h2 id="ç±»å‹-1"><a href="#ç±»å‹-1" class="headerlink" title="ç±»å‹ 1"></a>ç±»å‹ 1</h2><h3 id="1-Service-Management-framework"><a href="#1-Service-Management-framework" class="headerlink" title="1. Service Management framework"></a>1. Service Management framework</h3><ul><li><p><strong>API</strong>: <strong><code>SMLoginItemSetEnabled</code></strong></p></li><li><p><strong>How</strong>: main app çš„ <em><code>Contents/Library/LoginItems</code></em> ç›®å½•ä¸‹åŒ…å«ä¸€ä¸ª helper appï¼Œè¯¥ helper app å°†ä½œä¸º Login item ç”± Mac å¯åŠ¨ã€‚</p><p>  ä¹Ÿå°±æ˜¯è¯´ï¼Œmain app çš„ Build Phases ä¸­éœ€è¦æ·»åŠ ä¸€ä¸ª Copy Files é˜¶æ®µï¼Œå°† helper app deploy åˆ°è‡ªå·±çš„ä¸Šè¿°ç›®å½•ä¸‹ï¼Œç„¶åï¼Œåœ¨ main app çš„ä»£ç ä¸­ï¼Œé€šè¿‡è°ƒç”¨ <em><code>SMLoginItemSetEnabled:YES</code></em> å°† helper app å¯åŠ¨ï¼ŒåŒæ—¶è®¾ç½®æˆ Login itemã€‚åŒæ ·ï¼Œç¦ç”¨è¯¥ helper app ä¹Ÿæ˜¯ç”± main app åœ¨ä»£ç ä¸­æ§åˆ¶ï¼Œè°ƒç”¨ <em><code>SMLoginItemSetEnabled:NO</code></em> æ¥å®ç°ï¼Œå°†ä¼šæ€æ‰ helper appï¼Œå¹¶å–æ¶ˆ Login itemã€‚</p><p>  main app ä¼šä¼ é€’ç»™ <em><code>SMLoginItemSetEnabled</code></em> éœ€è¦å¯åŠ¨çš„ helper app çš„ Bundle IDï¼Œç„¶åè¯¥ API å°±ä¼šåœ¨ <em><code>Contents/Library/LoginItems</code></em> ä¸­å¯»æ‰¾è¯¥ helper appï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚</p><p>  <strong>æ³¨æ„</strong>ï¼šhelper app çš„ <code>Info.plist</code> ä¸­éœ€è¦è®¾ç½® <em><code>LSUIElement</code></em> æˆ–è€… <em><code>LSBackgroundOnly</code></em> ã€‚</p></li><li><p>è¯¥æ–¹æ³•æ·»åŠ çš„ Login item å¯¹ç”¨æˆ·æ˜¯ä¸å¯è§çš„ï¼Œåœ¨ System Preference ä¸­ä¹Ÿçœ‹ä¸åˆ°ã€‚</p></li><li><p><strong>e.g.</strong> <a href="https://github.com/wzqcongcong/MyDiskCleaner" target="_blank" rel="noopener">MyDiskCleaner</a></p></li></ul><h3 id="2-SMJobBless"><a href="#2-SMJobBless" class="headerlink" title="2. SMJobBless"></a>2. SMJobBless</h3><ul><li><p><strong>API</strong>: <strong><code>AuthorizationCreate</code> <code>SMJobBless</code></strong></p></li><li><p><strong>How</strong>: åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ª main app å’Œä¸€ä¸ª helper appï¼Œhelper app ä¸€èˆ¬æ˜¯ Command Line Tool ç±»å‹çš„ targetã€‚helper app deploy åˆ° main app çš„ <em><code>Contents/Library/LaunchServices</code></em> ç›®å½•ä¸‹ï¼Œç”± main app å°†å…¶æ³¨å†Œåˆ° Mac çš„ <em><code>LaunchDaemon</code></em> ä¸­ï¼Œå®ç°è‡ªå¯åŠ¨ã€‚</p><p>  main app ä»£ç ä¸­é¦–å…ˆéœ€è¦è°ƒç”¨ <em><code>AuthorizationCreate</code></em> æ¥è·å– admin æƒé™ï¼Œç„¶åå°†è·å–åˆ°çš„æƒé™è¿åŒ helper app çš„ Bundle ID ä¸€èµ·ä¼ ç»™ <em><code>SMJobBless</code></em>ï¼Œ<em><code>SMJobBless</code></em> ä¼šå°†è¯¥ helper app å¤åˆ¶åˆ° Mac çš„ <em><code>/Library/PrivilegedHelperTools</code></em> ç›®å½•ä¸‹ï¼ŒåŒæ—¶åœ¨ <em><code>/Library/LaunchDaemons</code></em> ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªç›¸åº”çš„ plist æ–‡ä»¶ï¼ŒMac å¯åŠ¨æ—¶ï¼Œç”± <em><code>launchctl</code></em> load è¯¥ plistï¼Œä»è€Œ load helper appã€‚</p><p>  <strong>æ³¨æ„</strong>ï¼šhelper app è¿™ä¸ª target éœ€è¦ä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚é¦–å…ˆï¼Œéœ€è¦ä¸ºå…¶æ–°å»ºä¸€ä¸ª <em><code>&lt;Bundle ID&gt;-Launchd.plist</code></em>ï¼Œè¯¥ plist ä¸­ä¼šå†™æ˜å¦‚ä½•è¢« <em><code>launchctl</code></em> loadï¼Œç„¶åï¼Œåœ¨ Build Settings ä¸­éœ€è¦è®¾ç½® <em><code>Other Linker Flags</code></em> çš„å€¼ï¼Œåœ¨å…¶ä¸­å†™å…¥ helper app çš„ Info.plist å’Œä¸Šé¢çš„ Launchd.plistã€‚è¿™æ ·ï¼Œåœ¨ç¼–è¯‘å‡ºçš„ target å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¼šæœ‰ä¸€æ®µç‰¹æ®Šçš„ä»£ç åŒºè®°å½•ç€å®ƒçš„ Info.plist å’Œ Launchd.plist ä¿¡æ¯ã€‚<em><code>SMJobBless</code></em> è°ƒç”¨ååœ¨ <em><code>/Library/LaunchDaemons</code></em> ç›®å½•ç”Ÿæˆçš„ plist æ–‡ä»¶å°±æ˜¯ç›´æ¥ä» target å¯æ‰§è¡Œæ–‡ä»¶ä¸­è¯»å–åˆ°çš„ã€‚</p><p>  <strong>æ³¨æ„</strong>ï¼š<em><code>SMJobBless</code></em> æ‰§è¡Œæ—¶ï¼Œå¦‚æœ <em><code>/Library/PrivilegedHelperTools</code></em> ç›®å½•ä¸‹å·²ç»æœ‰äº†ç›¸åŒ Bundle ID çš„ helper appï¼Œé‚£ä¹ˆé™¤éå…¶ <em><code>CFBundleShortVersion</code></em> ä¸åŒï¼Œå¦åˆ™æ˜¯ä¸ä¼šé‡æ–°è¦†ç›–çš„ã€‚æ‰€ä»¥å½“ helper app ä»£ç å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸ºäº†å¸Œæœ›èƒ½ deploy æ–°çš„ helper appï¼Œéœ€è¦åŒæ—¶æ›´æ–°å…¶ <em><code>CFBundleShortVersion</code></em>ï¼Œè¿™æ · <em><code>SMJobBless</code></em> æ‰ä¼šå°†æ–°çš„æœ‰æ•ˆçš„ helper app deploy åˆ° <em><code>/Library/PrivilegedHelperTools</code></em> ç›®å½•ä¸‹ï¼Œå¹¶å°†å…¶ load èµ·æ¥ã€‚</p></li><li><p>è¯¥æ–¹æ³•æ·»åŠ çš„ Login item å¯¹ç”¨æˆ·æ˜¯å¯è§çš„ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å’Œç›¸åº”çš„ plist æ–‡ä»¶çš„ä½ç½®å¦‚ä¸Šæ‰€è¿°ã€‚ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ <em><code>launchctl</code></em> æ¥ load/unloadã€‚è¯¥æ–¹æ³•ä¸ä»…æ·»åŠ äº† Login itemï¼Œè€Œä¸”è¿˜å®ç°äº†ææƒæ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œhelper app å°†ä¼šä»¥ admin æƒé™æ¥è¿è¡Œã€‚</p></li><li><p><strong>e.g.</strong> <a href="https://github.com/wzqcongcong/AppleTunerUpdater" target="_blank" rel="noopener">AppleTunerUpdater</a></p></li></ul><h3 id="3-OS-Launch-Services"><a href="#3-OS-Launch-Services" class="headerlink" title="3. OS Launch Services"></a>3. OS Launch Services</h3><ul><li><p><strong>API</strong>: <strong><code>LSSharedFileList</code> ç³»åˆ—</strong></p></li><li><p><strong>How</strong>: è²Œä¼¼è¿‡æ—¶äº†ï¼Ÿæ–‡æ¡£ä¸­æ²¡æœ‰ï¼ŸStackOverflow ä¸­æœ‰ç›¸å…³å¸–å­ä»‹ç»<a href="http://stackoverflow.com/questions/5449135/how-can-a-cocoa-application-add-itself-as-a-global-login-item" target="_blank" rel="noopener">ã€1ã€‘</a> <a href="http://stackoverflow.com/questions/14889956/launch-cocoa-application-for-all-users-during-login" target="_blank" rel="noopener">ã€2ã€‘</a></p></li><li><p>è¯¥æ–¹æ³•æ·»åŠ çš„ Login item å¯¹ç”¨æˆ·æ˜¯å¯è§çš„ï¼Œåœ¨ System Preference çš„ Users &amp; Groups ä¸­å¯ä»¥æŸ¥çœ‹åˆ°ç›¸åº”çš„ Login itemï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å¯ç”¨æˆ–è€…ç¦ç”¨ã€‚</p></li></ul><h2 id="ç±»å‹-2"><a href="#ç±»å‹-2" class="headerlink" title="ç±»å‹ 2"></a>ç±»å‹ 2</h2><h3 id="4-LaunchAgents-LaunchDaemons-ç›®å½•"><a href="#4-LaunchAgents-LaunchDaemons-ç›®å½•" class="headerlink" title="4. LaunchAgents / LaunchDaemons ç›®å½•"></a>4. LaunchAgents / LaunchDaemons ç›®å½•</h3><p>ç¼–å†™éœ€è¦çš„ plist æ–‡ä»¶ï¼Œå†™æ˜å¦‚ä½•è¢« <em><code>launchctl</code></em> loadï¼Œç„¶åå°† plist æ”¾ç½®åˆ° <em><code>LaunchAgents / LaunchDaemons</code></em> ç›®å½•ã€‚</p><ul><li>~/Library/LaunchAgents    ï¼ˆuser æƒé™ï¼Œåªå¯¹å½“å‰ user æœ‰æ•ˆï¼‰</li><li>/Library/LaunchAgents        ï¼ˆroot æƒé™ï¼Œå¯¹æ‰€æœ‰ user æœ‰æ•ˆï¼‰</li><li>/Library/LaunchDaemons    ï¼ˆroot æƒé™ï¼Œç³»ç»Ÿçº§åˆ«ï¼‰</li></ul><hr><p>æ€»ç»“ï¼š</p><p>å¯¹äº non Sandbox app æ¥è¯´ï¼Œä¸Šè¿°4ç§æ–¹æ³•éƒ½æ˜¯å¯è¡Œçš„ã€‚<br>å¯¹äº Sandbox app æ¥è¯´ï¼Œæ–¹æ³•1é€‚ç”¨ï¼Œæ–¹æ³•4å†™å…¥ <em><code>~/Library/LaunchAgents</code></em> ä¹Ÿé€‚ç”¨ï¼Œå…¶å®ƒæ–¹æ³•ä¸é€‚ç”¨ã€‚</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ Mac OS ä¸­ï¼Œæœ‰è®¸å¤šæœºåˆ¶å¯ä»¥ç”¨äºæ·»åŠ  Login itemï¼Œä¸åŒçš„ Login item ç±»å‹éœ€è¦ç”¨ä¸åŒçš„æ–¹å¼æ¥æ·»åŠ ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰è‡ªå·±çš„å·¥ä½œæµç¨‹ï¼Œåº”ç”¨èŒƒå›´ï¼Œä»¥åŠæœ€ç»ˆçš„è¡¨ç°æ•ˆæœã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Development" scheme="https://zongquan.wang/categories/Development/"/>
    
    
      <category term="Mac" scheme="https://zongquan.wang/tags/Mac/"/>
    
  </entry>
  
</feed>
